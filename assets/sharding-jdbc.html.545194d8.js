import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,f as e}from"./app.4d667c68.js";const p="/assets/f37ed482.3e6d02f9.png",t={},o=e(`<h1 id="sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868" tabindex="-1"><a class="header-anchor" href="#sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868" aria-hidden="true">#</a> sharding-jdbc\u5B9E\u73B0\u5206\u5E93\u5206\u8868</h1><h2 id="\u4E00\u3001-\u6570\u636E\u5E93\u8868\u51C6\u5907" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001-\u6570\u636E\u5E93\u8868\u51C6\u5907" aria-hidden="true">#</a> \u4E00\u3001 \u6570\u636E\u5E93\u8868\u51C6\u5907</h2><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> ds0<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> ds0<span class="token punctuation">;</span>
<span class="token keyword">USE</span> ds0<span class="token punctuation">;</span>

<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user0</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user0<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user0<span class="token punctuation">\`</span></span>  <span class="token punctuation">(</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u4E3B\u952EID&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u7528\u6237\u540D&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5BC6\u7801&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>sex<span class="token punctuation">\`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u6027\u522B&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>remark<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5907\u6CE8&#39;</span><span class="token punctuation">,</span>
                            <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">&#39;\u7528\u6237&#39;</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user1</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user1<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user1<span class="token punctuation">\`</span></span>  <span class="token punctuation">(</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u4E3B\u952EID&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u7528\u6237\u540D&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5BC6\u7801&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>sex<span class="token punctuation">\`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u6027\u522B&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>remark<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5907\u6CE8&#39;</span><span class="token punctuation">,</span>
                            <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">&#39;\u7528\u6237&#39;</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>


<span class="token comment">-- ===============================================================================================</span>


<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> ds1<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> ds1<span class="token punctuation">;</span>
<span class="token keyword">USE</span> ds1<span class="token punctuation">;</span>

<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user0</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user0<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user0<span class="token punctuation">\`</span></span>  <span class="token punctuation">(</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u4E3B\u952EID&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u7528\u6237\u540D&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5BC6\u7801&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>sex<span class="token punctuation">\`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u6027\u522B&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>remark<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5907\u6CE8&#39;</span><span class="token punctuation">,</span>
                            <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">&#39;\u7528\u6237&#39;</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for t_user1</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user1<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user1<span class="token punctuation">\`</span></span>  <span class="token punctuation">(</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u4E3B\u952EID&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u7528\u6237\u540D&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5BC6\u7801&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>sex<span class="token punctuation">\`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u6027\u522B&#39;</span><span class="token punctuation">,</span>
                            <span class="token identifier"><span class="token punctuation">\`</span>remark<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;\u5907\u6CE8&#39;</span><span class="token punctuation">,</span>
                            <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>user_id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">&#39;\u7528\u6237&#39;</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+p+`" alt=""></p><h2 id="\u4E8C\u3001\u6574\u5408" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u6574\u5408" aria-hidden="true">#</a> \u4E8C\u3001\u6574\u5408</h2><h3 id="_1\u3001pom\u4E2D\u5F15\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_1\u3001pom\u4E2D\u5F15\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 1\u3001<code>pom</code>\u4E2D\u5F15\u5165\u4F9D\u8D56</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- sharding-jdbc --&gt;</span>
<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.shardingsphere/sharding-jdbc-spring-boot-starter --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001application-yml\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_2\u3001application-yml\u914D\u7F6E" aria-hidden="true">#</a> 2\u3001<code>application.yml</code>\u914D\u7F6E</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># sharding-jdbc\u914D\u7F6E</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token comment"># \u662F\u5426\u5F00\u542FSQL\u663E\u793A</span>
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># ====================== \u2193\u2193\u2193\u2193\u2193\u2193 \u6570\u636E\u6E90\u914D\u7F6E \u2193\u2193\u2193\u2193\u2193\u2193 ======================</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> ds<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">,</span>ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>0<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">,</span>ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>0<span class="token punctuation">-</span><span class="token number">2</span><span class="token punctuation">,</span>ds<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">,</span>ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>1<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">,</span>ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>1<span class="token punctuation">-</span><span class="token number">2</span>
      <span class="token comment"># ====================== \u2193\u2193\u2193\u2193\u2193\u2193 \u914D\u7F6E\u7B2C1\u4E2A\u4E3B\u4ECE\u5E93 \u2193\u2193\u2193\u2193\u2193\u2193 ======================</span>
      <span class="token comment"># \u4E3B\u5E931</span>
      <span class="token key atrule">ds-master-0</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/ds0<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span> <span class="token comment"># MySQL\u5728\u9AD8\u7248\u672C\u9700\u8981\u6307\u660E\u662F\u5426\u8FDB\u884CSSL\u8FDE\u63A5 \u89E3\u51B3\u5219\u52A0\u4E0A &amp;useSSL=false</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
      <span class="token comment"># \u4E3B\u5E931-\u4ECE\u5E931</span>
      <span class="token key atrule">ds-slave-0-1</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3307/ds0<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span> <span class="token comment"># MySQL\u5728\u9AD8\u7248\u672C\u9700\u8981\u6307\u660E\u662F\u5426\u8FDB\u884CSSL\u8FDE\u63A5 \u89E3\u51B3\u5219\u52A0\u4E0A &amp;useSSL=false</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
      <span class="token comment"># \u4E3B\u5E931-\u4ECE\u5E932</span>
      <span class="token key atrule">ds-slave-0-2</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3307/ds0<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span> <span class="token comment"># MySQL\u5728\u9AD8\u7248\u672C\u9700\u8981\u6307\u660E\u662F\u5426\u8FDB\u884CSSL\u8FDE\u63A5 \u89E3\u51B3\u5219\u52A0\u4E0A &amp;useSSL=false</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
      <span class="token comment"># ====================== \u2193\u2193\u2193\u2193\u2193\u2193 \u914D\u7F6E\u7B2C2\u4E2A\u4E3B\u4ECE\u5E93 \u2193\u2193\u2193\u2193\u2193\u2193 ======================</span>
      <span class="token comment"># \u4E3B\u5E932</span>
      <span class="token key atrule">ds-master-1</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/ds1<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span> <span class="token comment"># MySQL\u5728\u9AD8\u7248\u672C\u9700\u8981\u6307\u660E\u662F\u5426\u8FDB\u884CSSL\u8FDE\u63A5 \u89E3\u51B3\u5219\u52A0\u4E0A &amp;useSSL=false</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
      <span class="token comment"># \u4E3B\u5E932-\u4ECE\u5E931</span>
      <span class="token key atrule">ds-slave-1-1</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3307/ds1<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span> <span class="token comment"># MySQL\u5728\u9AD8\u7248\u672C\u9700\u8981\u6307\u660E\u662F\u5426\u8FDB\u884CSSL\u8FDE\u63A5 \u89E3\u51B3\u5219\u52A0\u4E0A &amp;useSSL=false</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
      <span class="token comment"># \u4E3B\u5E932-\u4ECE\u5E932</span>
      <span class="token key atrule">ds-slave-1-2</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3307/ds1<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false</span> <span class="token comment"># MySQL\u5728\u9AD8\u7248\u672C\u9700\u8981\u6307\u660E\u662F\u5426\u8FDB\u884CSSL\u8FDE\u63A5 \u89E3\u51B3\u5219\u52A0\u4E0A &amp;useSSL=false</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root

    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token comment"># ====================== \u2193\u2193\u2193\u2193\u2193\u2193 \u5206\u5E93\u5206\u8868\u914D\u7F6E \u2193\u2193\u2193\u2193\u2193\u2193 ======================</span>
      <span class="token comment"># \u5206\u5E93\u7B56\u7565 =&gt; \u6839\u636Euser_id\u53D6\u6A21\u62C6\u5206\u5230\u4E0D\u540C\u7684\u5E93\u4E2D</span>
      <span class="token key atrule">default-database-strategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">inline</span><span class="token punctuation">:</span>
          <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> user_id
          <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> ds<span class="token punctuation">-</span>master<span class="token punctuation">-</span>$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>user_id % 2<span class="token punctuation">}</span>
      <span class="token comment"># \u5206\u8868\u7B56\u7565</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">t_user</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds<span class="token punctuation">-</span>master<span class="token punctuation">-</span>$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.t_user$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
          <span class="token key atrule">key-generator</span><span class="token punctuation">:</span>
            <span class="token key atrule">column</span><span class="token punctuation">:</span> user_id  <span class="token comment"># \u4E3B\u952EID</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE  <span class="token comment"># \u751F\u6210\u7B56\u7565</span>
          <span class="token comment"># \u6DFB\u52A0\u6570\u636E\u5206\u8868\u7B56\u7565</span>
          <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">inline</span><span class="token punctuation">:</span>
              <span class="token comment"># \u6DFB\u52A0\u6570\u636E\u5206\u8868\u5B57\u6BB5(\u6839\u636E\u5B57\u6BB5\u63D2\u5165\u6570\u636E\u5230\u90A3\u4E2A\u8868 ex\uFF1Asex)</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> sex
              <span class="token comment"># \u5206\u7247\u7B97\u6CD5\u8868\u8FBE\u5F0F =&gt; \u6839\u636E\u7528\u6237\u6027\u522B\u53D6\u6A21\u62C6\u5206\u5230\u4E0D\u540C\u7684\u8868\u4E2D</span>
              <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> t_user$<span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token punctuation">{</span>sex % 2<span class="token punctuation">}</span>

      <span class="token comment"># ====================== \u2193\u2193\u2193\u2193\u2193\u2193 \u8BFB\u5199\u5206\u79BB\u914D\u7F6E \u2193\u2193\u2193\u2193\u2193\u2193 ======================</span>
      <span class="token key atrule">master-slave-rules</span><span class="token punctuation">:</span>
        <span class="token key atrule">ds-master-0</span><span class="token punctuation">:</span>
          <span class="token comment"># \u4E3B\u5E93</span>
          <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> ds<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">0</span>
          <span class="token comment"># \u4ECE\u5E93</span>
          <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>0<span class="token punctuation">-</span><span class="token number">1</span>
            <span class="token punctuation">-</span> ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>0<span class="token punctuation">-</span><span class="token number">2</span>
          <span class="token comment"># \u4ECE\u5E93\u67E5\u8BE2\u6570\u636E\u7684\u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5 \u76EE\u524D\u67092\u79CD\u7B97\u6CD5 round_robin\uFF08\u8F6E\u8BE2\uFF09\u548C random\uFF08\u968F\u673A\uFF09</span>
          <span class="token comment"># \u7B97\u6CD5\u63A5\u53E3 org.apache.shardingsphere.spi.masterslave.MasterSlaveLoadBalanceAlgorithm</span>
          <span class="token comment"># \u5B9E\u73B0\u7C7B RandomMasterSlaveLoadBalanceAlgorithm \u548C RoundRobinMasterSlaveLoadBalanceAlgorithm</span>
          <span class="token key atrule">loadBalanceAlgorithmType</span><span class="token punctuation">:</span> ROUND_ROBIN
        <span class="token key atrule">ds-master-1</span><span class="token punctuation">:</span>
          <span class="token key atrule">masterDataSourceName</span><span class="token punctuation">:</span> ds<span class="token punctuation">-</span>master<span class="token punctuation">-</span><span class="token number">1</span>
          <span class="token key atrule">slaveDataSourceNames</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>1<span class="token punctuation">-</span><span class="token number">1</span>
            <span class="token punctuation">-</span> ds<span class="token punctuation">-</span>slave<span class="token punctuation">-</span>1<span class="token punctuation">-</span><span class="token number">2</span>
          <span class="token key atrule">loadBalanceAlgorithmType</span><span class="token punctuation">:</span> ROUND_ROBIN
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3\u3001\u5F15\u5165sharding-jdbc\u540E\u6570\u636E\u6E90\u5065\u5EB7\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F15\u5165sharding-jdbc\u540E\u6570\u636E\u6E90\u5065\u5EB7\u914D\u7F6E" aria-hidden="true">#</a> 3\u3001\u5F15\u5165sharding-jdbc\u540E\u6570\u636E\u6E90\u5065\u5EB7\u914D\u7F6E</h3><p>\u89E3\u51B3\u542F\u52A8\u62A5\u9519\u95EE\u9898: <code>ConnectionCallback; isValid; nested exception is java.sql.SQLFeatureNotSupportedException: isValid</code></p><p>\u539F\u56E0: springboot2.4\u6570\u636E\u6E90\u5065\u5EB7\u68C0\u67E5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceHealthConfig</span> <span class="token keyword">extends</span> <span class="token class-name">DataSourceHealthContributorAutoConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.datasource.dbcp2.validation-query:select 1}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> defaultQuery<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DataSourceHealthConfig</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">&gt;</span></span> dataSources<span class="token punctuation">,</span> <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DataSourcePoolMetadataProvider</span><span class="token punctuation">&gt;</span></span> metadataProviders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>dataSources<span class="token punctuation">,</span> metadataProviders<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">AbstractHealthIndicator</span> <span class="token function">createIndicator</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DataSourceHealthIndicator</span> indicator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DataSourceHealthIndicator</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">createIndicator</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>indicator<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            indicator<span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span>defaultQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> indicator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5230\u6B64\u914D\u7F6E\u5B8C\u6210\uFF0C\u7136\u540E\u5C31\u53EF\u4EE5\u81EA\u5DF1\u7F16\u5199CRUD\u8FDB\u884C\u6D4B\u8BD5\u4E86</p><h2 id="\u4E09\u3001docker-compose\u90E8\u7F72mysql\u4E3B\u4ECE" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001docker-compose\u90E8\u7F72mysql\u4E3B\u4ECE" aria-hidden="true">#</a> \u4E09\u3001docker-compose\u90E8\u7F72mysql\u4E3B\u4ECE</h2><h3 id="_1\u3001\u73AF\u5883\u51C6\u5907" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u73AF\u5883\u51C6\u5907" aria-hidden="true">#</a> 1\u3001\u73AF\u5883\u51C6\u5907</h3><p>\u521B\u5EFA<code>docker-compose-mysql-master-slave.yml</code>\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>

<span class="token comment"># \u7F51\u6865 -&gt; \u65B9\u4FBF\u76F8\u4E92\u901A\u8BAF</span>
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql-master</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/zhengqing/mysql<span class="token punctuation">:</span><span class="token number">5.7</span>  <span class="token comment"># \u539F\u955C\u50CF\`mysql:5.7\`</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql_master                                  <span class="token comment"># \u5BB9\u5668\u540D\u4E3A&#39;mysql_master&#39;</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped                                       <span class="token comment"># \u6307\u5B9A\u5BB9\u5668\u9000\u51FA\u540E\u7684\u91CD\u542F\u7B56\u7565\u4E3A\u59CB\u7EC8\u91CD\u542F\uFF0C\u4F46\u662F\u4E0D\u8003\u8651\u5728Docker\u5B88\u62A4\u8FDB\u7A0B\u542F\u52A8\u65F6\u5C31\u5DF2\u7ECF\u505C\u6B62\u4E86\u7684\u5BB9\u5668</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                                                      <span class="token comment"># \u6570\u636E\u5377\u6302\u8F7D\u8DEF\u5F84\u8BBE\u7F6E,\u5C06\u672C\u673A\u76EE\u5F55\u6620\u5C04\u5230\u5BB9\u5668\u76EE\u5F55</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-master-slave/master/my.cnf:/etc/mysql/my.cnf&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-master-slave/master/data:/var/lib/mysql&quot;</span>
      <span class="token comment">#      - &quot;./mysql-master-slave/master/conf.d:/etc/mysql/conf.d&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-master-slave/master/log/mysql/error.log:/var/log/mysql/error.log&quot;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>                        <span class="token comment"># \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF,\u76F8\u5F53\u4E8Edocker run\u547D\u4EE4\u4E2D\u7684-e</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">LANG</span><span class="token punctuation">:</span> en_US.UTF<span class="token punctuation">-</span><span class="token number">8</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root         <span class="token comment"># \u8BBE\u7F6Eroot\u7528\u6237\u5BC6\u7801</span>
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> demo              <span class="token comment"># \u521D\u59CB\u5316\u7684\u6570\u636E\u5E93\u540D\u79F0</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>                              <span class="token comment"># \u6620\u5C04\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql

  <span class="token key atrule">mysql-slave</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/zhengqing/mysql<span class="token punctuation">:</span><span class="token number">5.7</span>  <span class="token comment"># \u539F\u955C\u50CF\`mysql:5.7\`</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql_slave                                   <span class="token comment"># \u5BB9\u5668\u540D\u4E3A&#39;mysql_slave&#39;</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped                                       <span class="token comment"># \u6307\u5B9A\u5BB9\u5668\u9000\u51FA\u540E\u7684\u91CD\u542F\u7B56\u7565\u4E3A\u59CB\u7EC8\u91CD\u542F\uFF0C\u4F46\u662F\u4E0D\u8003\u8651\u5728Docker\u5B88\u62A4\u8FDB\u7A0B\u542F\u52A8\u65F6\u5C31\u5DF2\u7ECF\u505C\u6B62\u4E86\u7684\u5BB9\u5668</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                                                      <span class="token comment"># \u6570\u636E\u5377\u6302\u8F7D\u8DEF\u5F84\u8BBE\u7F6E,\u5C06\u672C\u673A\u76EE\u5F55\u6620\u5C04\u5230\u5BB9\u5668\u76EE\u5F55</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-master-slave/slave/my.cnf:/etc/mysql/my.cnf&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-master-slave/slave/data:/var/lib/mysql&quot;</span>
      <span class="token comment">#      - &quot;./mysql-master-slave/slave/conf.d:/etc/mysql/conf.d&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;./mysql-master-slave/slave/log/mysql/error.log:/var/log/mysql/error.log&quot;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>                        <span class="token comment"># \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF,\u76F8\u5F53\u4E8Edocker run\u547D\u4EE4\u4E2D\u7684-e</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">LANG</span><span class="token punctuation">:</span> en_US.UTF<span class="token punctuation">-</span><span class="token number">8</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root         <span class="token comment"># \u8BBE\u7F6Eroot\u7528\u6237\u5BC6\u7801</span>
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> demo              <span class="token comment"># \u521D\u59CB\u5316\u7684\u6570\u636E\u5E93\u540D\u79F0</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>                              <span class="token comment"># \u6620\u5C04\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3307:3306&quot;</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql<span class="token punctuation">-</span>master
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001\u8FD0\u884C" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8FD0\u884C" aria-hidden="true">#</a> 2\u3001\u8FD0\u884C</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose-mysql-master-slave.yml <span class="token parameter variable">-p</span> mysql-master-slave up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3\u3001\u4E3B\u4ECE\u5E93\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4E3B\u4ECE\u5E93\u914D\u7F6E" aria-hidden="true">#</a> 3\u3001\u4E3B\u4ECE\u5E93\u914D\u7F6E</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ================== \u2193\u2193\u2193\u2193\u2193\u2193 \u914D\u7F6E\u4E3B\u5E93 \u2193\u2193\u2193\u2193\u2193\u2193 ==================</span>
<span class="token comment"># \u8FDB\u5165\u4E3B\u5E93</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql_master /bin/bash
<span class="token comment"># \u767B\u5F55mysql</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot</span>
<span class="token comment">#  \u521B\u5EFA\u7528\u6237slave\uFF0C\u5BC6\u7801123456</span>
CREATE <span class="token environment constant">USER</span> <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># \u6388\u4E88slave\u7528\u6237 \`REPLICATION SLAVE\`\u6743\u9650\u548C\`REPLICATION CLIENT\`\u6743\u9650\uFF0C\u7528\u4E8E\u5728\`\u4E3B\` \`\u4ECE\` \u6570\u636E\u5E93\u4E4B\u95F4\u540C\u6B65\u6570\u636E</span>
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># \u6388\u4E88\u6240\u6709\u6743\u9650\u5219\u6267\u884C\u547D\u4EE4: GRANT ALL PRIVILEGES ON *.* TO &#39;slave&#39;@&#39;%&#39;;</span>
<span class="token comment"># \u4F7F\u64CD\u4F5C\u751F\u6548</span>
FLUSH PRIVILEGES<span class="token punctuation">;</span>
<span class="token comment"># \u67E5\u770B\u72B6\u6001</span>
show master status<span class="token punctuation">;</span>
<span class="token comment"># \u6CE8\uFF1AFile\u548CPosition\u5B57\u6BB5\u7684\u503Cslave\u4E2D\u5C06\u4F1A\u7528\u5230\uFF0C\u5728slave\u64CD\u4F5C\u5B8C\u6210\u4E4B\u524D\u4E0D\u8981\u64CD\u4F5Cmaster\uFF0C\u5426\u5219\u5C06\u4F1A\u5F15\u8D77\u72B6\u6001\u53D8\u5316\uFF0C\u5373File\u548CPosition\u5B57\u6BB5\u7684\u503C\u53D8\u5316 !!!</span>
<span class="token comment"># +------------------+----------+--------------+------------------+-------------------+</span>
<span class="token comment"># | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span>
<span class="token comment"># +------------------+----------+--------------+------------------+-------------------+</span>
<span class="token comment"># | mysql-bin.000003 |      769 |              |                  |                   |</span>
<span class="token comment"># +------------------+----------+--------------+------------------+-------------------+</span>
<span class="token comment"># 1 row in set (0.00 sec)</span>


<span class="token comment"># ================== \u2193\u2193\u2193\u2193\u2193\u2193 \u914D\u7F6E\u4ECE\u5E93 \u2193\u2193\u2193\u2193\u2193\u2193 ==================</span>
<span class="token comment"># \u8FDB\u5165\u4ECE\u5E93</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql_slave /bin/bash
<span class="token comment"># \u767B\u5F55mysql</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot</span>
change master to <span class="token assign-left variable">master_host</span><span class="token operator">=</span><span class="token string">&#39;www.zhengqingya.com&#39;</span>,master_port<span class="token operator">=</span><span class="token number">3306</span>, <span class="token assign-left variable">master_user</span><span class="token operator">=</span><span class="token string">&#39;slave&#39;</span>, <span class="token assign-left variable">master_password</span><span class="token operator">=</span><span class="token string">&#39;123456&#39;</span>, <span class="token assign-left variable">master_log_file</span><span class="token operator">=</span><span class="token string">&#39;mysql-bin.000003&#39;</span>, <span class="token assign-left variable">master_log_pos</span><span class="token operator">=</span> <span class="token number">769</span>, <span class="token assign-left variable">master_connect_retry</span><span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>
<span class="token comment"># \u5F00\u542F\u4E3B\u4ECE\u540C\u6B65\u8FC7\u7A0B  \u3010\u505C\u6B62\u547D\u4EE4\uFF1Astop slave;\u3011</span>
start slave<span class="token punctuation">;</span>
<span class="token comment"># \u67E5\u770B\u4E3B\u4ECE\u540C\u6B65\u72B6\u6001</span>
show slave status <span class="token punctuation">\\</span>G
<span class="token comment"># Slave_IO_Running \u548C Slave_SQL_Running \u90FD\u662FYes\u7684\u8BDD\uFF0C\u5C31\u8BF4\u660E\u4E3B\u4ECE\u540C\u6B65\u5DF2\u7ECF\u914D\u7F6E\u597D\u4E86\uFF01</span>
<span class="token comment"># \u5982\u679CSlave_IO_Running\u4E3AConnecting\uFF0CSlaveSQLRunning\u4E3AYes\uFF0C\u5219\u8BF4\u660E\u914D\u7F6E\u6709\u95EE\u9898\uFF0C\u8FD9\u65F6\u5019\u5C31\u8981\u68C0\u67E5\u914D\u7F6E\u4E2D\u54EA\u4E00\u6B65\u51FA\u73B0\u95EE\u9898\u4E86\u54E6\uFF0C\u53EF\u6839\u636ELast_IO_Error\u5B57\u6BB5\u4FE1\u606F\u6392\u9519\u6216\u8C37\u6B4C\u2026</span>
<span class="token comment"># *************************** 1. row ***************************</span>
<span class="token comment">#                Slave_IO_State: Waiting for master to send event</span>
<span class="token comment">#                   Master_Host: www.zhengqingya.com</span>
<span class="token comment">#                   Master_User: slave</span>
<span class="token comment">#                   Master_Port: 3306</span>
<span class="token comment">#                 Connect_Retry: 30</span>
<span class="token comment">#               Master_Log_File: mysql-bin.000003</span>
<span class="token comment">#           Read_Master_Log_Pos: 769</span>
<span class="token comment">#                Relay_Log_File: c598d8402b43-relay-bin.000002</span>
<span class="token comment">#                 Relay_Log_Pos: 320</span>
<span class="token comment">#         Relay_Master_Log_File: mysql-bin.000003</span>
<span class="token comment">#              Slave_IO_Running: Yes</span>
<span class="token comment">#             Slave_SQL_Running: Yes</span>
<span class="token comment">#               Replicate_Do_DB:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22),c=[o];function l(i,u){return s(),a("div",null,c)}const d=n(t,[["render",l],["__file","sharding-jdbc.html.vue"]]);export{d as default};
