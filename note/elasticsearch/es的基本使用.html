<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>esåŸºæœ¬ä½¿ç”¨ | HONGXU</title><meta name="description" content="ä¸ªäººåšå®¢">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.4e4a549b.css">
    <link rel="modulepreload" href="/assets/app.4d667c68.js"><link rel="modulepreload" href="/assets/esçš„åŸºæœ¬ä½¿ç”¨.html.78444edf.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/esçš„åŸºæœ¬ä½¿ç”¨.html.b4c6df75.js"><link rel="prefetch" href="/assets/index.html.a2ae31da.js"><link rel="prefetch" href="/assets/fafwfw.html.fb19f8c1.js"><link rel="prefetch" href="/assets/index.html.dced8a1d.js"><link rel="prefetch" href="/assets/FAQ.html.b3df9f36.js"><link rel="prefetch" href="/assets/ã€Markdownç¼–è¾‘å™¨å¿«æ·é”®ã€‘æ±‡æ€».html.ba090e64.js"><link rel="prefetch" href="/assets/test.html.ece31899.js"><link rel="prefetch" href="/assets/åŸºæœ¬å‘½ä»¤ä½¿ç”¨.html.9fcbb84f.js"><link rel="prefetch" href="/assets/ç®—æ³•é¢˜æ•´ç†.html.fca170e3.js"><link rel="prefetch" href="/assets/eså’Œkibanaå®‰è£…é…ç½®.html.656faf72.js"><link rel="prefetch" href="/assets/htmlçŸ¥è¯†ç‚¹æ•´ç†.html.83a414aa.js"><link rel="prefetch" href="/assets/mavené—®é¢˜æ•´ç†.html.364b8f73.js"><link rel="prefetch" href="/assets/oauth2çš„å…¨æµç¨‹.html.f1fb6e2c.js"><link rel="prefetch" href="/assets/é™æ€æ–¹æ³•è°ƒç”¨æ³¨å…¥bean.html.19bfd7e1.js"><link rel="prefetch" href="/assets/sharding-jdbc.html.87f28d8c.js"><link rel="prefetch" href="/assets/dockeræ­å»ºç¯å¢ƒ.html.6f21238d.js"><link rel="prefetch" href="/assets/ä½¿ç”¨Flywayè¿›è¡Œæ•°æ®åº“è¿ç§».html.97fd1d2d.js"><link rel="prefetch" href="/assets/Mavenå®ç°ä¸€é”®æ‰“åŒ…éƒ¨ç½².html.4ea59e9a.js"><link rel="prefetch" href="/assets/åŸºäºjenkins_dockerçš„æŒç»­é›†æˆç¯å¢ƒéƒ¨ç½².html.00a505a8.js"><link rel="prefetch" href="/assets/Quartzä»»åŠ¡è°ƒåº¦æ¡†æ¶åŸç†.html.80dc9ee9.js"><link rel="prefetch" href="/assets/Spring MVCä¹‹RequestContextHolderå’ŒLocaleContextHolderçš„ä½¿ç”¨è¯¦è§£ä»¥åŠä½¿ç”¨è¯¯åŒº.html.d3371f6b.js"><link rel="prefetch" href="/assets/QueryWrapperå¸¸ç”¨æ–¹æ³•.html.67081961.js"><link rel="prefetch" href="/assets/fastjsonçš„ä½¿ç”¨â€”â€”JSONå­—ç¬¦ä¸²ã€JSONå¯¹è±¡ã€Javaå¯¹è±¡çš„äº’è½¬.html.6ed95081.js"><link rel="prefetch" href="/assets/æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´.html.6114dd35.js"><link rel="prefetch" href="/assets/é›†åˆstreamç›¸å…³æ“ä½œ.html.de0ba4d9.js"><link rel="prefetch" href="/assets/é™æ€æ–¹æ³•å’Œæ³›å‹.html.27f3703b.js"><link rel="prefetch" href="/assets/docxå’Œdocäº’è½¬.html.4c3623e4.js"><link rel="prefetch" href="/assets/wordè½¬html.html.28971dfa.js"><link rel="prefetch" href="/assets/wordè½¬pdf.html.8acedd9b.js"><link rel="prefetch" href="/assets/å¦‚ä½•å®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦.html.ec30ee6d.js"><link rel="prefetch" href="/assets/å¦‚ä½•å®ç°æ¥å£å¹‚ç­‰æ€§.html.b5f98a8f.js"><link rel="prefetch" href="/assets/ç”Ÿæˆword.html.95aed98d.js"><link rel="prefetch" href="/assets/æ—¥å¿—é…ç½®æ–‡ä»¶.html.ab910729.js"><link rel="prefetch" href="/assets/mysql.html.00d7bf11.js"><link rel="prefetch" href="/assets/mysql8.0å®‰è£…æ•™ç¨‹(è§£å‹ç‰ˆ).html.c693637b.js"><link rel="prefetch" href="/assets/Oracleå…³äºdateç±»å‹çš„æŸ¥è¯¢æ–¹å¼åŠæ•ˆç‡æµ…æ.html.e1d4b7ab.js"><link rel="prefetch" href="/assets/Oracleç›¸å…³.html.6269a6be.js"><link rel="prefetch" href="/assets/idè‡ªå¢é•¿æ–¹æ¡ˆ.html.75f7ae19.js"><link rel="prefetch" href="/assets/oracleæ—¶é—´æˆ³å‡½æ•°åŠç›¸å…³æ“ä½œ.html.290edae3.js"><link rel="prefetch" href="/assets/sequence.html.01913139.js"><link rel="prefetch" href="/assets/æ‰¹é‡æ’å…¥æ•°æ®.html.24a0fa38.js"><link rel="prefetch" href="/assets/dubbo.html.55360f99.js"><link rel="prefetch" href="/assets/gateway.html.f4adc050.js"><link rel="prefetch" href="/assets/nacos.html.a19ee52c.js"><link rel="prefetch" href="/assets/sentinel.html.6cfa5ca1.js"><link rel="prefetch" href="/assets/securityä½¿ç”¨.html.8c0e1d31.js"><link rel="prefetch" href="/assets/securityåŸç†.html.a3199eaa.js"><link rel="prefetch" href="/assets/æ•´åˆelk.html.2f62cad0.js"><link rel="prefetch" href="/assets/æ•´åˆes.html.1dc0e47d.js"><link rel="prefetch" href="/assets/æ•´åˆminioå®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½.html.1ebaa1f9.js"><link rel="prefetch" href="/assets/kafkaä½¿ç”¨.html.668032c1.js"><link rel="prefetch" href="/assets/rabbitå®‰è£….html.6245e078.js"><link rel="prefetch" href="/assets/QueryWrapperã€LambdaQueryWrapperå’ŒLambdaQueryChainWrapperçš„ç”¨æ³•(äºŒ).html.3126dc49.js"><link rel="prefetch" href="/assets/UpdateWrapper.html.f21aa8bd.js"><link rel="prefetch" href="/assets/åˆ†é¡µ.html.7f44a976.js"><link rel="prefetch" href="/assets/åŸºç¡€ç”¨æ³•.html.53bfaf7d.js"><link rel="prefetch" href="/assets/æ‰¹é‡æ’å…¥.html.204f7f52.js"><link rel="prefetch" href="/assets/404.html.c5de7dd9.js"><link rel="prefetch" href="/assets/index.html.2f713335.js"><link rel="prefetch" href="/assets/index.html.1a811f74.js"><link rel="prefetch" href="/assets/index.html.79fe6d6e.js"><link rel="prefetch" href="/assets/index.html.dcd15e89.js"><link rel="prefetch" href="/assets/index.html.e8952663.js"><link rel="prefetch" href="/assets/index.html.5ad7ff00.js"><link rel="prefetch" href="/assets/index.html.92637d35.js"><link rel="prefetch" href="/assets/index.html.7e924de7.js"><link rel="prefetch" href="/assets/index.html.5b971275.js"><link rel="prefetch" href="/assets/index.html.a99d180d.js"><link rel="prefetch" href="/assets/index.html.fb16b232.js"><link rel="prefetch" href="/assets/index.html.0f8c6f75.js"><link rel="prefetch" href="/assets/fafwfw.html.9418a6e5.js"><link rel="prefetch" href="/assets/index.html.67148146.js"><link rel="prefetch" href="/assets/FAQ.html.be7774a6.js"><link rel="prefetch" href="/assets/ã€Markdownç¼–è¾‘å™¨å¿«æ·é”®ã€‘æ±‡æ€».html.a3551968.js"><link rel="prefetch" href="/assets/test.html.c0403a27.js"><link rel="prefetch" href="/assets/åŸºæœ¬å‘½ä»¤ä½¿ç”¨.html.403e251d.js"><link rel="prefetch" href="/assets/ç®—æ³•é¢˜æ•´ç†.html.facf7e00.js"><link rel="prefetch" href="/assets/eså’Œkibanaå®‰è£…é…ç½®.html.dfb75cf7.js"><link rel="prefetch" href="/assets/htmlçŸ¥è¯†ç‚¹æ•´ç†.html.f1b5256a.js"><link rel="prefetch" href="/assets/mavené—®é¢˜æ•´ç†.html.30f07f85.js"><link rel="prefetch" href="/assets/oauth2çš„å…¨æµç¨‹.html.7e9aec60.js"><link rel="prefetch" href="/assets/é™æ€æ–¹æ³•è°ƒç”¨æ³¨å…¥bean.html.1879f8c9.js"><link rel="prefetch" href="/assets/sharding-jdbc.html.545194d8.js"><link rel="prefetch" href="/assets/dockeræ­å»ºç¯å¢ƒ.html.0090b063.js"><link rel="prefetch" href="/assets/ä½¿ç”¨Flywayè¿›è¡Œæ•°æ®åº“è¿ç§».html.7969cb27.js"><link rel="prefetch" href="/assets/Mavenå®ç°ä¸€é”®æ‰“åŒ…éƒ¨ç½².html.d3916189.js"><link rel="prefetch" href="/assets/åŸºäºjenkins_dockerçš„æŒç»­é›†æˆç¯å¢ƒéƒ¨ç½².html.4fefae77.js"><link rel="prefetch" href="/assets/Quartzä»»åŠ¡è°ƒåº¦æ¡†æ¶åŸç†.html.983d8374.js"><link rel="prefetch" href="/assets/Spring MVCä¹‹RequestContextHolderå’ŒLocaleContextHolderçš„ä½¿ç”¨è¯¦è§£ä»¥åŠä½¿ç”¨è¯¯åŒº.html.d0e7a91a.js"><link rel="prefetch" href="/assets/QueryWrapperå¸¸ç”¨æ–¹æ³•.html.1d04aeaa.js"><link rel="prefetch" href="/assets/fastjsonçš„ä½¿ç”¨â€”â€”JSONå­—ç¬¦ä¸²ã€JSONå¯¹è±¡ã€Javaå¯¹è±¡çš„äº’è½¬.html.f7aedb9d.js"><link rel="prefetch" href="/assets/æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´.html.bd9e24ed.js"><link rel="prefetch" href="/assets/é›†åˆstreamç›¸å…³æ“ä½œ.html.5d829b4f.js"><link rel="prefetch" href="/assets/é™æ€æ–¹æ³•å’Œæ³›å‹.html.7d92d90f.js"><link rel="prefetch" href="/assets/docxå’Œdocäº’è½¬.html.027e2780.js"><link rel="prefetch" href="/assets/wordè½¬html.html.b8c060cf.js"><link rel="prefetch" href="/assets/wordè½¬pdf.html.208c3faa.js"><link rel="prefetch" href="/assets/å¦‚ä½•å®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦.html.90e39dd1.js"><link rel="prefetch" href="/assets/å¦‚ä½•å®ç°æ¥å£å¹‚ç­‰æ€§.html.b4c7cc49.js"><link rel="prefetch" href="/assets/ç”Ÿæˆword.html.bcdae325.js"><link rel="prefetch" href="/assets/æ—¥å¿—é…ç½®æ–‡ä»¶.html.23ba4e84.js"><link rel="prefetch" href="/assets/mysql.html.53f21f6e.js"><link rel="prefetch" href="/assets/mysql8.0å®‰è£…æ•™ç¨‹(è§£å‹ç‰ˆ).html.0b7ed189.js"><link rel="prefetch" href="/assets/Oracleå…³äºdateç±»å‹çš„æŸ¥è¯¢æ–¹å¼åŠæ•ˆç‡æµ…æ.html.f034dc09.js"><link rel="prefetch" href="/assets/Oracleç›¸å…³.html.21feb8c9.js"><link rel="prefetch" href="/assets/idè‡ªå¢é•¿æ–¹æ¡ˆ.html.b87477b7.js"><link rel="prefetch" href="/assets/oracleæ—¶é—´æˆ³å‡½æ•°åŠç›¸å…³æ“ä½œ.html.e3d7b56b.js"><link rel="prefetch" href="/assets/sequence.html.e2a339bc.js"><link rel="prefetch" href="/assets/æ‰¹é‡æ’å…¥æ•°æ®.html.0a289a1e.js"><link rel="prefetch" href="/assets/dubbo.html.316b69fc.js"><link rel="prefetch" href="/assets/gateway.html.5f6eb9b8.js"><link rel="prefetch" href="/assets/nacos.html.81ce69c5.js"><link rel="prefetch" href="/assets/sentinel.html.a994e5f2.js"><link rel="prefetch" href="/assets/securityä½¿ç”¨.html.840423d8.js"><link rel="prefetch" href="/assets/securityåŸç†.html.2cb58ad2.js"><link rel="prefetch" href="/assets/æ•´åˆelk.html.5ea6e37a.js"><link rel="prefetch" href="/assets/æ•´åˆes.html.78aba307.js"><link rel="prefetch" href="/assets/æ•´åˆminioå®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½.html.90252f2b.js"><link rel="prefetch" href="/assets/kafkaä½¿ç”¨.html.7941cb77.js"><link rel="prefetch" href="/assets/rabbitå®‰è£….html.085e5255.js"><link rel="prefetch" href="/assets/QueryWrapperã€LambdaQueryWrapperå’ŒLambdaQueryChainWrapperçš„ç”¨æ³•(äºŒ).html.34b4322d.js"><link rel="prefetch" href="/assets/UpdateWrapper.html.92cf4e7c.js"><link rel="prefetch" href="/assets/åˆ†é¡µ.html.76fcd1e0.js"><link rel="prefetch" href="/assets/åŸºç¡€ç”¨æ³•.html.3ce5c230.js"><link rel="prefetch" href="/assets/æ‰¹é‡æ’å…¥.html.895d4ad1.js"><link rel="prefetch" href="/assets/404.html.ec44aeb3.js"><link rel="prefetch" href="/assets/index.html.9191a9cd.js"><link rel="prefetch" href="/assets/index.html.c40b2015.js"><link rel="prefetch" href="/assets/index.html.2e16174c.js"><link rel="prefetch" href="/assets/index.html.e8b4d9fb.js"><link rel="prefetch" href="/assets/index.html.915b6ad9.js"><link rel="prefetch" href="/assets/index.html.195f978b.js"><link rel="prefetch" href="/assets/index.html.6fa4b8e4.js"><link rel="prefetch" href="/assets/index.html.0cce01dd.js"><link rel="prefetch" href="/assets/index.html.2ec3a18a.js"><link rel="prefetch" href="/assets/index.html.b142fe4a.js"><link rel="prefetch" href="/assets/index.html.f86f5ce1.js"><link rel="prefetch" href="/assets/mermaid.core.5ea15c44.js"><link rel="prefetch" href="/assets/photoswipe.esm.720e8656.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/images/logo.jpeg" alt="HONGXU"><!----><span class="site-name hide-in-pad">HONGXU</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><!---->ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/guide/fafwfw.html" class="nav-link" aria-label="å‘å¯¼"><!---->å‘å¯¼<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/easywhx/learning" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/note/FAQ.html" class="nav-link sidebar-link sidebar-page" aria-label="FAQ"><!---->FAQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/note/%E3%80%90Markdown%E7%BC%96%E8%BE%91%E5%99%A8%E5%BF%AB%E6%8D%B7%E9%94%AE%E3%80%91%E6%B1%87%E6%80%BB.html" class="nav-link sidebar-link sidebar-page" aria-label="Markdownå¿«æ·é”®"><!---->Markdownå¿«æ·é”®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">database</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">elasticsearch</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/note/elasticsearch/es%E5%92%8Ckibana%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html" class="nav-link sidebar-link sidebar-page" aria-label="eså’Œkibanaå®‰è£…é…ç½®"><!---->eså’Œkibanaå®‰è£…é…ç½®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/note/elasticsearch/es%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="esåŸºæœ¬ä½¿ç”¨"><!---->esåŸºæœ¬ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/elasticsearch/es%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html#åŸºç¡€å¢åˆ æ”¹æŸ¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºç¡€å¢åˆ æ”¹æŸ¥"><!---->åŸºç¡€å¢åˆ æ”¹æŸ¥<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/elasticsearch/es%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html#æœç´¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æœç´¢"><!---->æœç´¢<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">algorithm</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">html</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">JAVA</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Linux</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">maven</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Oauth2</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Spring</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">æ¶ˆæ¯ä¸­é—´ä»¶</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ç¯å¢ƒæ­å»º</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">åˆ†åº“åˆ†è¡¨</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">è¿ç§»</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">é¡¹ç›®éƒ¨ç½²</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">go</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">web</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ä¸­é—´ä»¶</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">å‰ç«¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">åº”ç”¨æ–¹æ¡ˆ</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">æ•°æ®åº“</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">æœåŠ¡å™¨ç¯å¢ƒ</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">æ¶æ„</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ç½‘ç»œé€šä¿¡</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->esåŸºæœ¬ä½¿ç”¨</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">HONGXU</span></span><span property="author" content="HONGXU"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´12æœˆ25æ—¥</span><meta property="datePublished" content="2022-12-25T15:22:16.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 19 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT19M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/elasticsearch/es%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html#åŸºç¡€å¢åˆ æ”¹æŸ¥" class="router-link-active router-link-exact-active toc-link level3">åŸºç¡€å¢åˆ æ”¹æŸ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/elasticsearch/es%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html#æœç´¢" class="router-link-active router-link-exact-active toc-link level3">æœç´¢</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="esåŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#esåŸºæœ¬ä½¿ç”¨" aria-hidden="true">#</a> esåŸºæœ¬ä½¿ç”¨</h1><p><a href="https://huaweicloud.csdn.net/637f7731dacf622b8df84da4.html" target="_blank" rel="noopener noreferrer">å‚è€ƒé“¾æ¥-ESåŸºæœ¬çŸ¥è¯†è¯­æ³•ä»¥åŠkibanaæ“ä½œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="é€šè¿‡kibanaæ¥æ“ä½œes-rest-api" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡kibanaæ¥æ“ä½œes-rest-api" aria-hidden="true">#</a> é€šè¿‡Kibanaæ¥æ“ä½œES Rest API</h4><p>çŸ¥è¯†ç‚¹æ€ç»´å¯¼å›¾ <img src="/assets/2624cf6e.16b66875.png" alt=""></p><h3 id="åŸºç¡€å¢åˆ æ”¹æŸ¥" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€å¢åˆ æ”¹æŸ¥" aria-hidden="true">#</a> åŸºç¡€å¢åˆ æ”¹æŸ¥</h3><h4 id="è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#è¯­æ³•" aria-hidden="true">#</a> è¯­æ³•</h4><p>(1) åˆ›å»º/å…¨é‡æ›¿æ¢</p><p>è®°å½•ä¸å­˜åœ¨å°±æ˜¯åˆ›å»º, å¦åˆ™æ˜¯å…¨é‡æ›¿æ¢.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /index/type/id  
{
&quot;å±æ€§å&quot; : &quot;value&quot;
...
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>12345<strong>åŠ ç²—æ ·å¼</strong> (2) åˆ›å»º/ä¿®æ”¹</p><p>åˆ›å»º</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//å¦‚æœä¸ä¼ id, åˆ™ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªUUID
POST /index/type/
{
&quot;å±æ€§å&quot;:ä¿®æ”¹å€¼
}
æˆ–è€…
POST /index/type/id
{
&quot;å±æ€§å&quot;:ä¿®æ”¹å€¼
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//æ²¡æœ‰å¸¦ä¸Šçš„å±æ€§ä¼šè¢«æ¸…é™¤
POST /index/type/id
{
&quot;å±æ€§å&quot;:ä¿®æ”¹å€¼
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) æŸ¥è¯¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /index/type/id

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>(4) åˆ é™¤</p><p>åªæ˜¯é€»è¾‘åˆ é™¤, å°†å…¶æ ‡è®°ä¸ºdelete, å½“æ•°æ®è¶Šæ¥è¶Šå¤šæ—¶, ESä¼šè‡ªåŠ¨ç‰©ç†åˆ é™¤.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DELETE /index/type/id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®ä¾‹</p><p>(1) æ–°å¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /company/employee/1
{
&quot;age&quot;:25,
&quot;salary&quot;:&quot;20k&quot;,
&quot;skill&quot;:[&quot;java&quot;,&quot;mysql&quot;,&quot;es&quot;]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /company/employee
{
&quot;age&quot;:30,
&quot;salary&quot;:&quot;30k&quot;,
&quot;skill&quot;:[&quot;python&quot;,&quot;redis&quot;,&quot;hadoop&quot;]
}

POST /company/employee/2
{
â€œageâ€:22,
â€œsalaryâ€:â€œ10kâ€,
â€œskillâ€:[â€œpythonâ€,â€œjavaâ€]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>POST å‘½ä»¤æ–°å¢æ•°æ®æ—¶, å¦‚æœä¸ä¼ id, åˆ™ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªUUID.</p><p>(2) æŸ¥è¯¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /company/employee/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>(3) ä¿®æ”¹</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /company/employee/1
{
&quot;age&quot;:40,
&quot;salary&quot;:&quot;100k&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /company/employee/1
{
&quot;age&quot;:18,
&quot;salary&quot;:&quot;50K&quot;,
&quot;skill&quot;:[&quot;c++&quot;]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>PUT æ˜¯å…¨é‡æ›¿æ¢, ä¸”æ˜¯å¹‚ç­‰æ“ä½œ. ä¸Šé¢çš„POSTä¿®æ”¹, skillå±æ€§è¢«æ¸…é™¤äº†, å±æ€§ç°åœ¨åªæœ‰ageå’Œsalary.</p><blockquote><p>å¹‚ç­‰æ“ä½œ: GET, PUT, DELETEéƒ½æ˜¯å¹‚ç­‰æ“ä½œ, æ‰§è¡Œå¤šæ¬¡ä¸æ‰§è¡Œä¸€æ¬¡ç»“æœä¸€æ ·.</p></blockquote><p>(4) åˆ é™¤</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DELETE /company/employee/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Partial Update éƒ¨åˆ†æ›´æ–°.</p><p>(1) è¯­æ³•</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>post /index/type/id/_update
{
&quot;doc&quot;: {
&quot;å±æ€§å&quot; : &quot;value&quot;
...
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2) ä¸å…¨é‡æ›¿æ¢å’Œæ™®é€šä¿®æ”¹çš„åŒºåˆ«</p><p>åœ¨åº”ç”¨ç¨‹åºä¸­, å…¨é‡æ›¿æ¢æ˜¯å…ˆä»ESä¸­æŸ¥è¯¢å‡ºè®°å½•, ç„¶ååœ¨ä¿®æ”¹, ä¸€ä¸ªå±æ€§éƒ½ä¸èƒ½å°‘. è€Œéƒ¨åˆ†æ›´æ–°å°±ä¸ç”¨å…ˆä»ESæŸ¥è¯¢è®°å½•äº†, å¯ä»¥ç›´æ¥ä¿®æ”¹, ä¸”ä¸ç”¨æ‰€æœ‰å±æ€§éƒ½åˆ—å‡º.</p><p>éƒ¨åˆ†æ›´æ–°å¦‚æœåªåŒ…å«éƒ¨åˆ†å±æ€§, é‚£ä¹ˆå…¶ä»–æ²¡æœ‰è¢«åŒ…å«çš„å±æ€§ä»ç„¶å­˜åœ¨, ä½†æ™®é€šä¿®æ”¹å…¶ä»–æ²¡æœ‰è¢«åŒ…å«çš„å±æ€§å°±ç›´æ¥æ¸…é™¤äº†.</p><p>(3) å®ä¾‹</p><p>a. å…ˆæ·»åŠ ä¸€æ¡æ•°æ®</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /school/student/1
{
&quot;name&quot;: &quot;alice&quot;,
&quot;age&quot;: 17
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. æµ‹è¯•éƒ¨åˆ†æ›´æ–°</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//éƒ¨åˆ†æ›´æ–°
POST /school/student/1/_update
{
&quot;doc&quot;: {
&quot;name&quot; : &quot;Tom&quot;
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>//æŸ¥è¯¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /school/student/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>//ç»“æœ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
â€œ_indexâ€: â€œschoolâ€,
â€œ_typeâ€: â€œstudentâ€,
â€œ_idâ€: â€œ1â€,
â€œ_versionâ€: 7,
â€œfoundâ€: true,
â€œ_sourceâ€: {
â€œnameâ€: â€œTomâ€,
â€œageâ€: 17
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c. æµ‹è¯•æ™®é€šä¿®æ”¹</p><p>//æ™®é€šä¿®æ”¹</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /school/student/1
{
&quot;name&quot; : &quot;Linda&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>//æŸ¥è¯¢ GET school/student/1</p><p>//ç»“æœ { â€œ_indexâ€: â€œschoolâ€, â€œ_typeâ€: â€œstudentâ€, â€œ_idâ€: â€œ1â€, â€œ_versionâ€: 8, â€œfoundâ€: true, â€œ_sourceâ€: { â€œnameâ€: â€œLindaâ€ } }</p><p>Bulk Operation æ‰¹é‡æŸ¥è¯¢å’Œæ‰¹é‡å¢åˆ æ”¹çš„è¯­æ³•ä¸åŒ, æ‰€ä»¥åˆ†å¼€æ¥ä»‹ç».</p><p>æ‰¹é‡æŸ¥è¯¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /_mget
{
&quot;docs&quot; : [
{
&quot;_index&quot; : &quot;company&quot;,
&quot;_type&quot; : &quot;employee&quot;,
&quot;_id&quot; : 1
},
{
&quot;_index&quot; : &quot;company&quot;,
&quot;_type&quot; : &quot;employee&quot;,
&quot;_id&quot; : 2
}
]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GET /company/_mget { â€œdocsâ€ : [ { â€œ_typeâ€ : â€œemployeeâ€, â€œ_idâ€ : 1 }, { â€œ_typeâ€ : â€œemployeeâ€, â€œ_idâ€ : 2 } ] }</p><p>GET /company/employee/_mget { â€œidsâ€ : [1,2] }</p><p>æ‰¹é‡å¢åˆ æ”¹</p><p>(1) è¯­æ³•</p><p>æ¯ä¸€ä¸ªæ“ä½œè¦ä¸¤ä¸ªjsonä¸²ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /index/type/_bulk
{&quot;action&quot;: {&quot;metadata&quot;}}
{&quot;data&quot;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>indexå’Œtypeå¯ä»¥æ”¾å…¥metadataä¸­. æ¯ä¸ªjsonä¸²ä¸èƒ½æ¢è¡Œ, åªèƒ½æ”¾ä¸€è¡Œ. åŒæ—¶ä¸€ä¸ªjsonä¸²å’Œä¸€ä¸ªjsonä¸²ä¹‹é—´, å¿…é¡»æœ‰ä¸€ä¸ªæ¢è¡Œ.</p><p>(2) actionç±»å‹</p><p>delete</p><p>åˆ é™¤.</p><p>create</p><p>å¼ºåˆ¶åˆ›å»º. PUT /index/type/id/_create</p><p>index</p><p>åˆ›å»ºæˆ–æ›¿æ¢.</p><p>update</p><p>å±äºéƒ¨åˆ†æ›´æ–°.</p><p>(3) å®ä¾‹</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /_bulk
{&quot;delete&quot; : {&quot;_index&quot;:&quot;company&quot;, &quot;_type&quot;:&quot;employee&quot;,&quot;_id&quot;:&quot;1&quot;}}
{&quot;create&quot; :{&quot;_index&quot;:&quot;company&quot;,&quot;_type&quot;:&quot;employee&quot;,&quot;_id&quot;:&quot;2&quot;}}
{&quot;name&quot;:&quot;tyshawn&quot;, &quot;age&quot;:18}
{&quot;index&quot;:{&quot;_index&quot;:&quot;company&quot;,&quot;_type&quot;:&quot;employee&quot;,&quot;_id&quot;:&quot;3&quot;}}
{&quot;name&quot;:&quot;lee&quot;, &quot;age&quot;:24}
{&quot;update&quot;:{&quot;_index&quot;:&quot;company&quot;,&quot;_type&quot;:&quot;employee&quot;,&quot;_id&quot;:&quot;2&quot;}}
{&quot;doc&quot;:{&quot;age&quot;:30}}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æœç´¢" tabindex="-1"><a class="header-anchor" href="#æœç´¢" aria-hidden="true">#</a> æœç´¢</h3><p>æ·»åŠ æœç´¢å®ä¾‹æ•°æ®.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PUT /website/article/1
{
&quot;post_date&quot;: &quot;2017-01-01&quot;,
&quot;title&quot;: &quot;my first article&quot;,
&quot;content&quot;: &quot;this is my first article in this website&quot;,
&quot;author_id&quot;: 11401,
&quot;tags&quot;: [
&quot;java&quot;,
&quot;c&quot;
]
}
PUT /website/article/2
{
â€œpost_dateâ€: â€œ2017-01-02â€,
â€œtitleâ€: â€œmy second articleâ€,
â€œcontentâ€: â€œthis is my second article in this websiteâ€,
â€œauthor_idâ€: 11402,
â€œtagsâ€: [
â€œredisâ€,
â€œlinuxâ€
]
}

PUT /website/article/3
{
â€œpost_dateâ€: â€œ2017-01-03â€,
â€œtitleâ€: â€œmy third articleâ€,
â€œcontentâ€: â€œthis is my third article in this websiteâ€,
â€œauthor_idâ€: 11403,
â€œtagsâ€: [
â€œelaticsearchâ€,
â€œkafkaâ€
]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mappingç»“æ„å¦‚ä¸‹:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/_mapping/article
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>{ â€œwebsiteâ€: { â€œmappingsâ€: { â€œarticleâ€: { â€œpropertiesâ€: { â€œauthor_idâ€: { â€œtypeâ€: â€œlongâ€ }, â€œcontentâ€: { â€œtypeâ€: â€œtextâ€, â€œfieldsâ€: { â€œkeywordâ€: { â€œtypeâ€: â€œkeywordâ€, â€œignore_aboveâ€: 256 } } }, â€œpost_dateâ€: { â€œtypeâ€: â€œdateâ€ }, â€œtagsâ€: { â€œtypeâ€: â€œtextâ€, â€œfieldsâ€: { â€œkeywordâ€: { â€œtypeâ€: â€œkeywordâ€, â€œignore_aboveâ€: 256 } } }, â€œtitleâ€: { â€œtypeâ€: â€œtextâ€, â€œfieldsâ€: { â€œkeywordâ€: { â€œtypeâ€: â€œkeywordâ€, â€œignore_aboveâ€: 256 } } } } } } } }</p><p>å½“type = textæ—¶, ESé»˜è®¤ä¼šè®¾ç½®ä¸¤ä¸ªfield, ä¸€ä¸ªåˆ†è¯, ä¸€ä¸ªä¸åˆ†è¯. å¦‚contentä¼šåˆ†è¯, è€Œcontent.keywordä¸åˆ†è¯, content.keywordæœ€å¤šä¿ç•™256ä¸ªå­—ç¬¦.</p><p>é€šç”¨è¯­æ³•</p><p>(1) æœç´¢æ‰€æœ‰indexæ•°æ®.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /_search

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>1 (2) æœç´¢æŒ‡å®šindex, typeä¸‹çš„æ•°æ®(indexå’Œtypeå¯ä»¥æœ‰å¤šä¸ª)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /index1/_search
GET /index1,index2/_search
GET /index1/type1/_search
GET /index1/type1,type2/_search
GET /index1,index2/type1,type2/_search
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) æœç´¢æ‰€æœ‰indexä¸‹çš„æŒ‡å®štypeçš„æ•°æ®.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /_all/employee,product/_search
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸‹é¢å†ä»‹ç»Elasticsearchæœç´¢çš„æ¡ä»¶è¯­æ³•.</p><h5 id="query-string-search" tabindex="-1"><a class="header-anchor" href="#query-string-search" aria-hidden="true">#</a> query string search</h5><p>è¿™ä¸ªæŸ¥è¯¢å°±ç±»ä¼¼äºHTTPé‡Œçš„GETè¯·æ±‚, å‚æ•°æ”¾åœ¨URLä¸Š.</p><p>(1) è¯­æ³•</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /index/type/_search?q=å±æ€§å:å±æ€§å€¼
GET /index/type/_search?q=+å±æ€§å:å±æ€§å€¼
GET /index/type/_search?q=-å±æ€§å:å±æ€§å€¼
ä¹Ÿå¯ä»¥çœç•¥å±æ€§å, ç›´æ¥q=å±æ€§å€¼
GET /index/type/_search?q=å±æ€§å€¼

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2) + å’Œ - çš„åŒºåˆ«</p><p>é»˜è®¤æ˜¯+, æŒ‡å¿…é¡»åŒ…å«è¯¥å­—æ®µ, - æŒ‡ä¸åŒ…å«è¯¥å­—æ®µ.</p><p>(3) å®ä¾‹</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search?q=author_id:11403
GET /website/article/_search?q=-author_id:11403
GET /website/article/_search?q=11403

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(4) _all metadataçš„åŸç†</p><p>GET /index/type/_search?q=å±æ€§å€¼.</p><p>è¿™ä¸ªè¯­å¥æ˜¯ä»æ‰€æœ‰å±æ€§ä¸­æœç´¢åŒ…å«æŒ‡å®šçš„å…³é”®å­—çš„æ•°æ®. é‚£ä¹ˆESåœ¨æœç´¢æ—¶æ˜¯éå†æ‰€æœ‰documentä¸­çš„æ¯ä¸€ä¸ªfieldå—? ä¸æ˜¯çš„, æˆ‘ä»¬åœ¨æ’å…¥ä¸€æ¡documentæ—¶, ESä¼šè‡ªåŠ¨å°†å¤šä¸ªfieldçš„å€¼, å…¨éƒ¨ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼ä¸²è”èµ·æ¥, å˜æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸²(ä»¥ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦)ï¼Œä½œä¸º_all fieldçš„å€¼ï¼ŒåŒæ—¶è¿›è¡Œåˆ†è¯å»ºç«‹å€’æ’ç´¢å¼•. å¦‚æœåœ¨æœç´¢æ—¶æ²¡æœ‰æŒ‡å®šå±æ€§å, å°±ä¼šé»˜è®¤æœç´¢_all field. (ç”Ÿäº§ç¯å¢ƒä¸ä½¿ç”¨)</p><h4 id="query-dsl" tabindex="-1"><a class="header-anchor" href="#query-dsl" aria-hidden="true">#</a> query DSL</h4><p>DSL, Domain Specified Languageï¼Œç‰¹å®šé¢†åŸŸçš„è¯­è¨€. è¿™ä¸ªæŸ¥è¯¢å°±ç±»ä¼¼äºHTTPé‡Œçš„POSTè¯·æ±‚, å‚æ•°æ”¾åœ¨bodyä¸­.</p><p>å®ä¾‹: ä»websiteç´¢å¼•ä¸­æŸ¥è¯¢æ‰€æœ‰æ–‡ç« </p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match_all&quot;: {}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="full-text-search" tabindex="-1"><a class="header-anchor" href="#full-text-search" aria-hidden="true">#</a> full-text search</h5><p>å…¨æ–‡æœç´¢.</p><p>(1) åŸºç¡€ä½¿ç”¨</p><p>a. æœç´¢æ ‡é¢˜ä¸­åŒ…å«firstæˆ–secondçš„æ–‡ç« </p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;title&quot;: &quot;first second&quot;
}
}
}

æˆ–è€…

GET /website/article/_search
{
â€œqueryâ€: {
â€œmatchâ€: {
â€œtitleâ€: {
â€œqueryâ€: â€œfirst secondâ€
, â€œoperatorâ€: â€œorâ€
}
}
}
}

æˆ–è€…

GET /website/article/_search
{
â€œqueryâ€: {
â€œboolâ€: {
â€œshouldâ€: [
{â€œmatchâ€: {
â€œtitleâ€:â€œfirstâ€
}},
{â€œmatchâ€: {
â€œtitleâ€:â€œsecondâ€
}}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. æœç´¢æ ‡é¢˜ä¸­åŒ…å«firstå’Œsecondçš„æ–‡ç« </p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;title&quot;: {
&quot;query&quot;: &quot;first second&quot;
, &quot;operator&quot;: &quot;and&quot;
}
}
}
}
æˆ–è€…

GET /website/article/_search
{
â€œqueryâ€: {
â€œboolâ€: {
â€œmustâ€: [
{â€œmatchâ€: {
â€œtitleâ€: â€œfirstâ€
}},
{â€œmatchâ€: {
â€œtitleâ€: â€œsecondâ€
}}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c. æœç´¢æ ‡é¢˜ä¸­è‡³å°‘åŒ…å«first, second, third, fourthä¸­ä¸‰ä¸ªå•è¯çš„æ–‡ç« .</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;title&quot;: {
&quot;query&quot;: &quot;first second third fourth&quot;,
&quot;minimum_should_match&quot;: &quot;75%&quot;
}
}
}
}
æˆ–è€…

GET /website/article/_search
{
â€œqueryâ€: {
â€œboolâ€: {
â€œshouldâ€: [
{â€œmatchâ€: {
â€œtitleâ€: â€œfirstâ€
}},
{â€œmatchâ€: {
â€œtitleâ€: â€œsecondâ€
}},
{â€œmatchâ€: {
â€œtitleâ€: â€œthirdâ€
}},
{â€œmatchâ€: {
â€œtitleâ€: â€œfourthâ€
}}
],
â€œminimum_number_should_matchâ€: 3
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d. ä»websiteç´¢å¼•ä¸­æŸ¥è¯¢, æ ‡é¢˜å¿…é¡»åŒ…å«elasticsearchï¼Œå†…å®¹å¯ä»¥åŒ…å«elasticsearchä¹Ÿå¯ä»¥ä¸åŒ…å«ï¼Œä½œè€…idå¿…é¡»ä¸ä¸º111.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;bool&quot;: {
&quot;must&quot;: [
{
&quot;match&quot;: {
&quot;title&quot;:&quot;elasticsearch&quot;
}
}
],
&quot;should&quot;: [
{
&quot;match&quot;: {
&quot;content&quot;:&quot;elasticsearch&quot;
}
}
],
&quot;must_not&quot;: [
{
&quot;match&quot;: {
&quot;author_id&quot;:&quot;111&quot;
}
}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>e. ä»websiteç´¢å¼•ä¸­æŸ¥è¯¢, æ ‡é¢˜åŒ…å«first, åŒæ—¶æŒ‰ä½œè€…idé™åºæ’åº</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;title&quot;: &quot;first&quot;
}
},
&quot;sort&quot;: [
{
&quot;author_id&quot;: {
&quot;order&quot;: &quot;desc&quot;
}
}
]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>f. ä»websiteç´¢å¼•ä¸­åˆ†é¡µæŸ¥è¯¢ï¼Œæ€»å…±3ç¯‡æ–‡ç« ï¼Œå‡è®¾æ¯é¡µå°±æ˜¾ç¤º1ç¯‡æ–‡ç« ï¼Œç°åœ¨æ˜¾ç¤ºç¬¬2é¡µ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match_all&quot;: {}
},
&quot;from&quot;: 1,
&quot;size&quot;: 1
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>g. ä»websiteç´¢å¼•ä¸­æŸ¥è¯¢æ‰€æœ‰æ–‡ç« , åªæ˜¾ç¤ºpost_date, titleä¸¤ä¸ªå±æ€§.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match_all&quot;: {}
},
&quot;_source&quot;: [&quot;post_date&quot;,&quot;title&quot;]
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>h. æœç´¢æ ‡é¢˜ä¸­åŒ…å« article çš„æ–‡ç« , å¦‚æœæ ‡é¢˜ä¸­åŒ…å«firstæˆ–secondå°±ä¼˜å…ˆæœç´¢å‡ºæ¥, åŒæ—¶, å¦‚æœä¸€ä¸ªæ–‡ç« æ ‡é¢˜åŒ…å«first article, å¦ä¸€ä¸ªæ–‡ç« æ ‡é¢˜åŒ…å«second article, åŒ…å«first articleçš„æ–‡ç« è¦ä¼˜å…ˆæœç´¢å‡ºæ¥.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//é€šè¿‡åŠ æƒé‡æ¥å¤„ç†, é»˜è®¤æƒé‡ä¸º1
GET /website/article/_search
{
&quot;query&quot;: {
&quot;bool&quot;: {
&quot;must&quot;: [
{&quot;match&quot;: {
&quot;title&quot;: &quot;article&quot;
}}
],
&quot;should&quot;: [
{&quot;match&quot;: {
&quot;title&quot;: {
&quot;query&quot;: &quot;first&quot;,
&quot;boost&quot; : 3
}
}},
{&quot;match&quot;: {
&quot;title&quot;: {
&quot;query&quot;: &quot;second&quot;,
&quot;boost&quot;: 2
}
}}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2) multi_match</p><p>multi_match ç”¨äºæŸ¥è¯¢è¯åŒ¹é…å¤šä¸ªå±æ€§. è¿™é‡Œæ¶‰åŠåˆ°å‡ ç§åŒ¹é…ç­–ç•¥:</p><p>best-fields</p><p>docçš„æŸä¸ªå±æ€§åŒ¹é…å°½å¯èƒ½å¤šçš„å…³é”®è¯, é‚£ä¹ˆè¿™ä¸ªdocä¼šä¼˜å…ˆè¿”å›.</p><p>most-fields</p><p>æŸä¸ªå…³é”®è¯åŒ¹é…docå°½å¯èƒ½å¤šçš„å±æ€§, é‚£ä¹ˆè¿™ä¸ªdocä¼šä¼˜å…ˆè¿”å›.</p><p>cross_fields</p><p>è·¨è¶Šå¤šä¸ªfieldæœç´¢ä¸€ä¸ªå…³é”®è¯.</p><p>best-fieldså’Œmost-fieldsçš„åŒºåˆ«:</p><p>æ¯”å¦‚, doc1çš„field1åŒ¹é…çš„ä¸‰ä¸ªå…³é”®è¯, doc2çš„field1, field2éƒ½åŒ¹é…ä¸Šäº†åŒä¸€ä¸ªå…³é”®è¯. å¦‚æœæ˜¯best-fieldsç­–ç•¥, åˆ™doc1çš„ç›¸å…³åº¦åˆ†æ•°è¦æ›´é«˜, å¦‚æœæ˜¯most-fieldsç­–ç•¥, åˆ™doc2çš„ç›¸å…³åº¦åˆ†æ•°è¦æ›´é«˜.</p><p>å®ä¾‹:</p><p>a. ä½¿ç”¨best_fieldsç­–ç•¥, ä»titleå’Œcontentä¸­æœç´¢&quot;my third article&quot;.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;multi_match&quot;: {
&quot;query&quot;: &quot;my third article&quot;,
&quot;type&quot;: &quot;best_fields&quot;,
&quot;fields&quot;: [&quot;title&quot;,&quot;content&quot;]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. ä»titleå’Œcontentä¸­æœç´¢&quot;my third article&quot;, ä¸”è¿™ä¸‰ä¸ªå•è¯è¦è¿åœ¨ä¸€èµ·.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;multi_match&quot;: {
&quot;query&quot;: &quot;my third article&quot;,
&quot;type&quot;: &quot;cross_fields&quot;,
&quot;operator&quot;: &quot;and&quot;,
&quot;fields&quot;: [&quot;title&quot;,&quot;content&quot;]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) dis_max</p><p>åœ¨æˆ‘ä»¬è¿›è¡Œå¤šä¸ªæ¡ä»¶çš„å…¨æ–‡æœç´¢æ—¶, æœ€åçš„è®¡ç®—å‡ºçš„ç›¸å…³åº¦åˆ†æ•°æ˜¯æ ¹æ®å¤šä¸ªæ¡ä»¶çš„åŒ¹é…åˆ†æ•°ç»¼åˆè€Œæ¥çš„, æ¯”å¦‚score = (score1 + score2) / 2, å¦‚æœæˆ‘ä»¬æƒ³è®©æœ€ç»ˆçš„ç›¸å…³åº¦åˆ†æ•°ç­‰äºå¤šä¸ªæ¡ä»¶åŒ¹é…åˆ†æ•°ä¸­çš„æœ€å¤§å€¼, å³score = max(score1, score2), åˆ™å¯ä»¥ä½¿ç”¨dis_max.</p><p>å®ä¾‹: æœç´¢titleæˆ–contentä¸­åŒ…å«firstæˆ–articleçš„æ–‡ç« </p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;bool&quot;: {
&quot;should&quot;: [
{
&quot;match&quot;: {
&quot;title&quot;: &quot;first article&quot;
}
},
{
&quot;match&quot;: {
&quot;content&quot;: &quot;first article&quot;
}
}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨dis_max:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;dis_max&quot;: {
&quot;queries&quot;: [
{
&quot;match&quot;: {
&quot;title&quot;: &quot;first article&quot;
}
},
{
&quot;match&quot;: {
&quot;content&quot;: &quot;first article&quot;
}
}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(4) tie_breaker</p><p>tie_breakeræ˜¯ä¸dis_maxé…å¥—ä½¿ç”¨çš„. dis_maxåªå–åˆ†æ•°æœ€å¤§çš„é‚£ä¸ªæ¡ä»¶çš„åˆ†æ•°, å®Œå…¨ä¸è€ƒè™‘å…¶ä»–æ¡ä»¶çš„åˆ†æ•°, ä½†å¦‚æœåœ¨æŸäº›åœºæ™¯ä¸‹ä¹Ÿéœ€è¦è€ƒè™‘å…¶ä»–æ¡ä»¶çš„åˆ†æ•°å‘¢? æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªç³»æ•°å€¼tie_breaker, å°†å…¶ä»–æ¡ä»¶çš„åˆ†æ•°ä¹˜ä»¥tie_breaker, ç„¶åå’Œæœ€å¤§åˆ†æ•°ç»¼åˆèµ·æ¥è®¡ç®—æœ€ç»ˆå¾—åˆ†.</p><p>tie_breakerçš„å–å€¼ä¸º 0 ~ 1ä¹‹é—´.</p><p>a. å°†ä¸Šé¢çš„å®ä¾‹ä¼˜åŒ–ä¸‹:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;dis_max&quot;: {
&quot;tie_breaker&quot;: 0.7,
&quot;queries&quot;: [
{
&quot;match&quot;: {
&quot;title&quot;: &quot;first article&quot;
}
},
{
&quot;match&quot;: {
&quot;content&quot;: &quot;first article&quot;
}
}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. ç»§ç»­ä¼˜åŒ–. å¦‚æœæœç´¢è¯åŒ…å«å¤šä¸ªå…³é”®å­—, æˆ‘ä»¬è¦æ±‚è‡³å°‘åŒ¹é…å¤šä¸ªå…³é”®è¯, ä¸”å¤šä¸ªæ¡ä»¶çš„æƒé‡ä¸åŒ.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;dis_max&quot;: {
&quot;tie_breaker&quot;: 0.7,
&quot;queries&quot;: [
{
&quot;match&quot;: {
&quot;title&quot;: {
&quot;query&quot;: &quot;first article hello world&quot;,
&quot;minimum_should_match&quot;: &quot;50%&quot;,
&quot;boost&quot;: 2
}
}
},
{
&quot;match&quot;: {
&quot;content&quot;: {
&quot;query&quot;: &quot;first article is my hero&quot;,
&quot;minimum_should_match&quot;: &quot;20%&quot;,
&quot;boost&quot;: 1
}
}
}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>phrase search</p><p>(1) çŸ­è¯­æœç´¢, ä¸å…¨æ–‡æœç´¢æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢?</p><p>å…¨æ–‡æœç´¢ä¼šå°†&quot;æŸ¥è¯¢è¯&quot;æ‹†è§£å¼€æ¥, å»å€’æ’ç´¢å¼•ä¸­ä¸€ä¸€åŒ¹é…, åªè¦èƒ½åŒ¹é…ä¸Šä»»æ„ä¸€ä¸ªæ‹†è§£åçš„å…³é”®è¯, å°±å¯ä»¥ä½œä¸ºç»“æœè¿”å›. è€ŒçŸ­è¯­æœç´¢åœ¨å…¨æ–‡æœç´¢çš„åŸºç¡€ä¸Š, è¦æ±‚å…³é”®è¯å¿…é¡»ç›¸é‚». (æ³¨æ„çŸ­è¯­æœç´¢çš„&quot;æŸ¥è¯¢è¯&quot;ä¹Ÿæ˜¯ä¼šè¢«åˆ†è¯çš„)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;title&quot;: &quot;first article&quot;
}
}
}
//ä¸‰æ¡è®°å½•éƒ½ä¼šæœç´¢å‡ºæ¥
GET /website/article/_search
{
â€œqueryâ€: {
â€œmatch_phraseâ€: {
â€œtitleâ€: â€œfirst articleâ€
}
}
}
//åªæœ‰ä¸€æ¡è®°å½•
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2) åŸç†:</p><p>çŸ­è¯­æœç´¢çš„åŸç†å®é™…ä¸Šæ˜¯ç›¸é‚»åŒ¹é…(proximity match). Luceneå»ºç«‹çš„å€’æ’ç´¢å¼•ç»“æ„ä¸º: å…³é”®è¯ -&gt; æ–‡æ¡£å·, åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®, åœ¨æ–‡æ¡£å‡ºç°çš„é¢‘ç‡ç­‰, å½“ä¸€ä¸ª&quot;æŸ¥è¯¢è¯&quot;åŒ…å«å¤šä¸ªå…³é”®è¯æ—¶, Luceneå…ˆé€šè¿‡å…³é”®è¯æ‰¾åˆ°å¯¹åº”çš„æ–‡æ¡£å·, åˆ¤æ–­å¤šä¸ªå…³é”®è¯æ‰€åœ¨çš„æ–‡æ¡£å·æ˜¯å¦ç›¸åŒ, ç„¶åå†åˆ¤æ–­åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®æ˜¯å¦ç›¸é‚».</p><p>(3) å®ä¾‹</p><p>çŸ­è¯­æœç´¢é»˜è®¤æ˜¯æœç´¢ç›¸é‚»çš„å…³é”®è¯, ä½†ä¹Ÿå¯ä»¥æœç´¢é—´éš”å‡ ä¸ªä½ç½®çš„å…³é”®è¯. é—´éš”è¶Šå°ç›¸å…³åº¦åˆ†æ•°è¶Šé«˜.</p><p>a. ä»contentä¸­æœç´¢&quot;first website&quot;, firstå’Œwebsiteå¿…é¡»åœ¨åŒä¸€ä¸ªdocä¸­, ä¸”é—´éš”ä¸èƒ½è¶…è¿‡10.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match_phrase&quot;: {
&quot;content&quot;: {
&quot;query&quot;: &quot;first website&quot;,
&quot;slop&quot;: 10
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. å…¨æ–‡æœç´¢å’ŒçŸ­è¯­æœç´¢é…åˆä½¿ç”¨. ä»contentä¸­æœç´¢&quot;first website&quot;, åœ¨ä¼˜å…ˆæ»¡è¶³å¬å›ç‡çš„å‰æä¸‹, å°½å¯èƒ½æé«˜ç²¾å‡†åº¦.</p><p>å¬å›ç‡: ä»nä¸ªdocä¸­æœç´¢, æœ‰å¤šå°‘ä¸ªdocè¿”å›. ç²¾å‡†åº¦: è®©ä¸¤ä¸ªå…³é”®è¯é—´éš”è¶Šå°çš„docç›¸å…³åº¦åˆ†æ•°è¶Šé«˜.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;bool&quot;: {
&quot;must&quot;: [
{
&quot;match&quot;: {
&quot;content&quot;: &quot;first website&quot;
}
}
],
&quot;should&quot;: [
{
&quot;match_phrase&quot;: {
&quot;content&quot;: {
&quot;query&quot;: &quot;first website&quot;,
&quot;slop&quot;: 10
}
}
}
]
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(4) ä¼˜åŒ–çŸ­è¯­æœç´¢: rescore</p><p>çŸ­è¯­æœç´¢çš„æ€§èƒ½è¦æ¯”å…¨æ–‡æœç´¢çš„æ€§èƒ½ä½10å€ä»¥ä¸Š, æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬è¦ç”¨çŸ­è¯­æœç´¢æ—¶éƒ½ä¼šé…åˆå…¨æ–‡æœç´¢ä½¿ç”¨. å…ˆé€šè¿‡å…¨æ–‡æœç´¢å‡ºåŒ¹é…çš„doc, ç„¶åå¯¹ç›¸å…³åº¦åˆ†æ•°æœ€é«˜çš„å‰næ¡docè¿›è¡ŒrescoreçŸ­è¯­æœç´¢. (è¿™é‡Œåªèƒ½ç”¨äºåˆ†é¡µæœç´¢)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;content&quot;: &quot;first website&quot;
}
},
&quot;rescore&quot;: {
&quot;window_size&quot;: 20,
&quot;query&quot;: {
&quot;rescore_query&quot;: {
&quot;match_phrase&quot;: {
&quot;content&quot;: {
&quot;query&quot;: &quot;first website&quot;,
&quot;slop&quot;: 10
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(5) match_phrase_prefix</p><p>åŒ¹é…çŸ­è¯­çš„å‰ç¼€, ç”¨äºåšæœç´¢æ¨è. æ¯”å¦‚æˆ‘ä»¬åœ¨ç™¾åº¦è¾“å…¥ä¸€ä¸ªå…³é”®è¯, ç«‹é©¬å°±ä¼šæ¨èä¸€ç³»åˆ—æŸ¥è¯¢è¯, è¿™ä¸ªå°±æ˜¯æœç´¢æ¨è.</p><p>è¿™ä¸ªåŠŸèƒ½ä¸æ¨èä½¿ç”¨, å› ä¸ºæ€§èƒ½å¤ªå·®, æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ngramåˆ†è¯æœºåˆ¶æ¥å®ç°æœç´¢æ¨è.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match_phrase_prefix&quot;: {
&quot;title&quot;: &quot;my sec&quot;
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="fuzzy-search" tabindex="-1"><a class="header-anchor" href="#fuzzy-search" aria-hidden="true">#</a> fuzzy search</h5><p>æ¨¡ç³Šæœç´¢, è‡ªåŠ¨å°†æ‹¼å†™é”™è¯¯çš„æœç´¢æ–‡æœ¬è¿›è¡Œçº æ­£, ç„¶åå»åŒ¹é…ç´¢å¼•ä¸­çš„æ•°æ®.</p><p>(1) è¯­æ³•ä¸€</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;fuzzy&quot;: {
&quot;title.keyword&quot;: {
&quot;value&quot;: &quot;my wecond article&quot;,
&quot;fuzziness&quot;: 2
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>fuzzinessä»£è¡¨æœ€å¤šçº æ­£å¤šå°‘ä¸ªå­—æ¯, é»˜è®¤ä¸º2. æœç´¢æ–‡æœ¬ä¸ä¼šè¢«åˆ†è¯.</p><p>(2) è¯­æ³•äºŒ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;match&quot;: {
&quot;title&quot;: {
&quot;query&quot;: &quot;my wecond article&quot;,
&quot;fuzziness&quot;: &quot;auto&quot;,
&quot;operator&quot;: &quot;and&quot;
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>fuzzinesså¯ä»¥ç»™å®šä¸ªæ•°, ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºauto.</p><h5 id="term-search" tabindex="-1"><a class="header-anchor" href="#term-search" aria-hidden="true">#</a> term search</h5><p>termæŸ¥è¯¢, æ˜¯ä¸€ç§ç»“æ„åŒ–æŸ¥è¯¢, &quot;æŸ¥è¯¢è¯&quot;ä¸ä¼šè¢«åˆ†è¯, ç»“æœè¦ä¹ˆå­˜åœ¨è¦ä¹ˆä¸å­˜åœ¨, ä¸å…³å¿ƒç»“æœçš„scoreç›¸å…³åº¦. å¦‚æœæŸ¥è¯¢textå±æ€§, éœ€è¦æ”¹ä¸ºæŸ¥è¯¢filed.keyword.</p><p>(1) å®ä¾‹</p><p>å’ŒçŸ­è¯­æœç´¢å¯¹æ¯”ä¸€ä¸‹å¯ä»¥æ›´å¥½çš„ç†è§£:</p><ol><li>phraseæœç´¢</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>   GET /website/article/_search
   {
   &quot;query&quot;: {
   &quot;match_phrase&quot;: {
   &quot;title&quot;: &quot;my first article&quot;
   }
   }
   }
   //å­˜åœ¨ä¸€æ¡ç»“æœ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.termæœç´¢text</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
â€œqueryâ€: {
â€œtermâ€: {
â€œtitleâ€: {
â€œvalueâ€: â€œmy first articleâ€
}
}
}
}
//ä¸å­˜åœ¨ç»“æœ, åŸå› æ˜¯è¯è¯­æŸ¥è¯¢çš„valueå€¼ä¸ä¼šè¢«åˆ†è¯, ä¹Ÿå°±æ˜¯ç›´æ¥æŸ¥è¯¢&quot;my first article&quot;.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€‚termæœç´¢keyword</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
â€œqueryâ€: {
â€œtermâ€: {
â€œtitle.keywordâ€: {
â€œvalueâ€: â€œmy first articleâ€
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>//å­˜åœ¨ä¸€æ¡ç»“æœ, filed.keywordå±æ€§ä¸åˆ†è¯.</p><p>(2) å¸¸ç”¨è¯­æ³•</p><p>ä¸ºäº†æé«˜æ•ˆç‡, termæœç´¢ä¸€èˆ¬ä¸filterå’Œconstant_scoreè”ç”¨. constant_score ä»¥å›ºå®šçš„è¯„åˆ†æ¥æ‰§è¡ŒæŸ¥è¯¢(é»˜è®¤ä¸º1), è€Œfilterä¸è®¡ç®—scoreç›¸å…³åº¦, å› æ­¤æ‰§è¡Œæ•ˆç‡éå¸¸é«˜.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;term&quot;: {
&quot;post_date&quot;: &quot;2017-01-03&quot;
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="query-filter" tabindex="-1"><a class="header-anchor" href="#query-filter" aria-hidden="true">#</a> query filter</h4><p>(1) è¯­æ³•</p><p>query filter ç”¨äºè¿‡æ»¤æ•°æ®, ä¸å‚ä¸scoreç›¸å…³åº¦è®¡ç®—, æ•ˆç‡å¾ˆé«˜. é€‚ç”¨äºèŒƒå›´æŸ¥è¯¢ä»¥åŠä¸è®¡ç®—ç›¸å…³åº¦scoreçš„ç²¾ç¡®æŸ¥è¯¢(filter + term)</p><p>(2) å®ä¾‹</p><p>a. ä»websiteç´¢å¼•ä¸­æŸ¥è¯¢, ä½œè€…idå¿…é¡»å¤§äºç­‰äº11402ï¼ŒåŒæ—¶å‘è¡¨æ—¶é—´å¿…é¡»æ˜¯2017-01-02.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;bool&quot;: {
&quot;must&quot;: [
{
&quot;term&quot;: {
&quot;post_date&quot;: &quot;2017-01-02&quot;
}
},
{
&quot;range&quot;: {
&quot;author_id&quot;: {
&quot;gte&quot;: 11402
}
}
}
]
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. æœç´¢å‘å¸ƒæ—¥æœŸä¸º2017-01-01, æˆ–è€…æ–‡ç« æ ‡é¢˜ä¸º&quot;my first article&quot;çš„å¸–å­, åŒæ—¶è¦æ±‚æ–‡ç« çš„å‘å¸ƒæ—¥æœŸç»å¯¹ä¸ä¸º2017-01-02.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;bool&quot;: {
&quot;should&quot;: [
{
&quot;term&quot;:{
&quot;post_date&quot;: &quot;2017-01-01&quot;
}
},
{
&quot;term&quot;:{
&quot;title.keyword&quot;: &quot;my first article&quot;
}
}
],
&quot;must_not&quot;: {
&quot;term&quot;: {
&quot;post_date&quot;: &quot;2017-01-02&quot;
}
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c. æœç´¢æ–‡ç« æ ‡é¢˜ä¸º&quot;my first article&quot;, æˆ–è€…æ˜¯æ–‡ç« æ ‡é¢˜ä¸º&quot;my second article&quot;, è€Œä¸”å‘å¸ƒæ—¥æœŸä¸º&quot;2017-01-01&quot;çš„æ–‡ç« .</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;bool&quot;: {
&quot;should&quot;: [
{
&quot;term&quot;:{
&quot;title.keyword&quot;: &quot;my first article&quot;
}
},
{
&quot;bool&quot;: {
&quot;must&quot;: [
{
&quot;term&quot;:{
&quot;title.keyword&quot;: &quot;my second article&quot;
}
},
{
&quot;term&quot;:{
&quot;post_date&quot;: &quot;2017-01-01&quot;
}
}
]
}
}
]
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d. æœç´¢æ–‡ç« æ ‡é¢˜ä¸º&quot;my first article&quot;æˆ–&quot;my second article&quot;çš„æ–‡ç« </p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;terms&quot;: {
&quot;title.keyword&quot;: [
&quot;my first article&quot;,
&quot;my second article&quot;
]
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>e. æœç´¢tagsä¸­åŒ…å«javaçš„å¸–å­.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;terms&quot;: {
&quot;tags.keyword&quot;: [
&quot;java&quot;
]
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„, è¿™é‡Œå¿…é¡»ç”¨terms, å› ä¸ºtermä¸æ”¯æŒæ•°ç»„.</p><p>d. æœç´¢tagsä¸­åªåŒ…å«javaçš„å¸–å­.</p><p>å¦‚æœæƒ³æœç´¢tagsä¸­åªåŒ…å«javaçš„å¸–å­, å°±éœ€è¦æ–°å¢ä¸€ä¸ªå­—æ®µtags_count, è¡¨ç¤ºtagsä¸­æœ‰å‡ ä¸ªtag, å¦åˆ™å°±æ— æ³•æœç´¢.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search
{
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;bool&quot;: {
&quot;must&quot;: [
{
&quot;terms&quot;: {
&quot;tags.keyword&quot;: [
&quot;java&quot;
]
}
},
{
&quot;term&quot;: {
&quot;tags_count&quot;: &quot;1&quot;
}
}
]
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹ä¸Šé¢è¿™å‡ å®ä¾‹åšä¸ªæ€»ç»“, shouldè¡¨ç¤ºæˆ–, mustè¡¨ç¤ºä¸”.</p><h5 id="scroll-search" tabindex="-1"><a class="header-anchor" href="#scroll-search" aria-hidden="true">#</a> scroll search</h5><p>scrollæ»šåŠ¨æœç´¢ï¼Œå¯ä»¥å…ˆæœç´¢ä¸€æ‰¹æ•°æ®ï¼Œç„¶åä¸‹æ¬¡å†æœç´¢ä¸€æ‰¹æ•°æ®ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœç´¢å‡ºå…¨éƒ¨çš„æ•°æ®æ¥. å®ƒçš„åŸç†æ˜¯æ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½ç”Ÿæˆä¸€ä¸ªæ¸¸æ ‡scroll_id, åç»­çš„æŸ¥è¯¢æ ¹æ®è¿™ä¸ªæ¸¸æ ‡å»è·å–æ•°æ®, ç›´åˆ°è¿”å›çš„hitså­—æ®µä¸ºç©º. scroll_idç›¸å½“äºå»ºç«‹äº†ä¸€ä¸ªå†å²å¿«ç…§, åœ¨æ­¤ä¹‹åçš„å†™æ“ä½œä¸ä¼šå½±å“åˆ°è¿™ä¸ªå¿«ç…§çš„ç»“æœ, ä¹Ÿå°±æ„å‘³ç€å…¶ä¸èƒ½ç”¨äºå®æ—¶æŸ¥è¯¢.</p><p>æ»šåŠ¨æŸ¥è¯¢ç”¨æ¥è§£å†³æ·±åº¦åˆ†é¡µçš„é—®é¢˜, å°±ç±»ä¼¼äºsqlè¯­å¥: select * from comment where id &gt; 1000 order by id asc limit 1000.</p><p>(1) è¯­æ³•</p><p>æŸ¥è¯¢æ—¶æŒ‡å®šä¸€ä¸ªå‚æ•°scroll, ä»£è¡¨scroll_idçš„æœ‰æ•ˆæœŸ, è¿‡æœŸåscroll_idä¼šè¢«ESè‡ªåŠ¨æ¸…é™¤. å¦‚æœä¸éœ€è¦ç‰¹å®šçš„æ’åº, æŒ‰ç…§æ–‡æ¡£åˆ›å»ºæ—¶é—´æ’åºæ›´é«˜æ•ˆ. scroll_idåªèƒ½ä½¿ç”¨ä¸€æ¬¡, ä½¿ç”¨è¿‡åä¼šè¢«è‡ªåŠ¨åˆ é™¤. æœ€åä¸€æ¬¡æŸ¥è¯¢, hitsä¸ºç©ºæ—¶ä¹Ÿä¼šè¿”å›ä¸€ä¸ªscroll_id, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ é™¤æ¥é‡Šæ”¾èµ„æº. (2) å®ä¾‹</p><p>a. é¦–æ¬¡æŸ¥è¯¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /website/article/_search?scroll=1s
{
&quot;query&quot;: {
&quot;match_all&quot;: {}
},
&quot;sort&quot;: [
{
&quot;_doc&quot;: {
&quot;order&quot;: &quot;asc&quot;
}
}
],
&quot;size&quot;: 1
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. åç»­æŸ¥è¯¢</p><p>scroll_idåªèƒ½ä½¿ç”¨ä¸€æ¬¡.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /_search/scroll?scroll=1s&amp;scroll_id=DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAATqFmRBQ3FwUFVrUUw2VHgyU2I5UWRMRlEAAAAAAAAE6xZkQUNxcFBVa1FMNlR4MlNiOVFkTEZRAAAAAAAABOwWZEFDcXBQVWtRTDZUeDJTYjlRZExGUQAAAAAAAATtFmRBQ3FwUFVrUUw2VHgyU2I5UWRMRlEAAAAAAAAE7hZkQUNxcFBVa1FMNlR4MlNiOVFkTEZR
{
}
æˆ–è€…

GET /_search/scroll
{
â€œscrollâ€:â€œ1sâ€, â€œscroll_idâ€:â€œDnF1ZXJ5VGhlbkZldGNoBQAAAAAAAATqFmRBQ3FwUFVrUUw2VHgyU2I5UWRMRlEAAAAAAAAE6xZkQUNxcFBVa1FMNlR4MlNiOVFkTEZRAAAAAAAABOwWZEFDcXBQVWtRTDZUeDJTYjlRZExGUQAAAAAAAATtFmRBQ3FwUFVrUUw2VHgyU2I5UWRMRlEAAAAAAAAE7hZkQUNxcFBVa1FMNlR4MlNiOVFkTEZRâ€
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c. åˆ é™¤æŒ‡å®šscroll_id</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DELETE /_search/scroll
{
&quot;scroll_id&quot;: &quot;scroll_id=DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAAiXFmRBQ3FwUFVrUUw2VHgyU2I5UWRMRlEAAAAAAAAImBZkQUNxcFBVa1FMNlR4MlNiOVFkTEZRAAAAAAAACJkWZEFDcXBQVWtRTDZUeDJTYjlRZExGUQAAAAAAAAiaFmRBQ3FwUFVrUUw2VHgyU2I5UWRMRlEAAAAAAAAImxZkQUNxcFBVa1FMNlR4MlNiOVFkTEZR==&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d. åˆ é™¤æ‰€æœ‰scroll_id</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DELETE /_search/scroll/_all

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="èšåˆ" tabindex="-1"><a class="header-anchor" href="#èšåˆ" aria-hidden="true">#</a> èšåˆ</h4><p>èšåˆåŒ…æ‹¬åˆ†ç»„å’Œç»Ÿè®¡, å…¶ä¸­åˆ†ç»„æ“ä½œåŒ…æ‹¬term, histogram, date_histogram, filter. ç»Ÿè®¡æ“ä½œåŒ…æ‹¬count, avg, max, min, sum, cardinality, percentiles, percentile_ranksç­‰.</p><p>æ³¨æ„: èšåˆçš„å±æ€§ä¸èƒ½è¢«åˆ†è¯.</p><p>è¯­æ³•</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /index/type/_search
{
size: 0,
&quot;aggs&quot;: {
&quot;NAME&quot;: {
&quot;AGG_TYPE&quot;: {
&quot;field&quot;: &quot;field_name&quot;
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>NAMEä¸ºèšåˆæ“ä½œçš„åç§°, å¯ä»¥å–ä¸€ä¸ªæœ‰å‚è€ƒæ„ä¹‰çš„åç§°. AGG_TYPEä¸ºåˆ†ç»„æˆ–ç»Ÿè®¡æ“ä½œ, å½“è¿›è¡Œåˆ†ç»„æ“ä½œæ—¶, ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªdoc_count, ç»Ÿè®¡äº†ç»„å†…æ•°æ®çš„æ•°é‡. é»˜è®¤æŒ‰ç…§doc_counté™åºæ’åˆ—. size=0çš„åŸå› æ˜¯ä¸éœ€è¦æœç´¢ç»“æœ, å¦‚æœéœ€è¦æœç´¢ç»“æœ, åˆ™å»é™¤size=0.</p><p>å®ä¾‹</p><p>(1) å®ä¾‹æ•°æ®</p><p>æ–°å¢ç”µè§†æœºé”€å”®è®°å½•, ç”¨äºæ¥ä¸‹æ¥çš„å®ä¾‹åˆ†æ.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /televisions/sales/_bulk
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 1000, &quot;color&quot; : &quot;çº¢è‰²&quot;, &quot;brand&quot; : &quot;é•¿è™¹&quot;, &quot;sold_date&quot; : &quot;2016-10-28&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 2000, &quot;color&quot; : &quot;çº¢è‰²&quot;, &quot;brand&quot; : &quot;é•¿è™¹&quot;, &quot;sold_date&quot; : &quot;2016-11-05&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 3000, &quot;color&quot; : &quot;ç»¿è‰²&quot;, &quot;brand&quot; : &quot;å°ç±³&quot;, &quot;sold_date&quot; : &quot;2016-05-18&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 1500, &quot;color&quot; : &quot;è“è‰²&quot;, &quot;brand&quot; : &quot;TCL&quot;, &quot;sold_date&quot; : &quot;2016-07-02&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 1200, &quot;color&quot; : &quot;ç»¿è‰²&quot;, &quot;brand&quot; : &quot;TCL&quot;, &quot;sold_date&quot; : &quot;2016-08-19&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 2000, &quot;color&quot; : &quot;çº¢è‰²&quot;, &quot;brand&quot; : &quot;é•¿è™¹&quot;, &quot;sold_date&quot; : &quot;2016-11-05&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 8000, &quot;color&quot; : &quot;çº¢è‰²&quot;, &quot;brand&quot; : &quot;ä¸‰æ˜Ÿ&quot;, &quot;sold_date&quot; : &quot;2017-01-01&quot; }
{ &quot;index&quot;: {}}
{ &quot;price&quot; : 2500, &quot;color&quot; : &quot;è“è‰²&quot;, &quot;brand&quot; : &quot;å°ç±³&quot;, &quot;sold_date&quot; : &quot;2017-02-12&quot; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mappingç»“æ„å¦‚ä¸‹:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/_mapping/sales
{
&quot;televisions&quot;: {
&quot;mappings&quot;: {
&quot;sales&quot;: {
&quot;properties&quot;: {
&quot;brand&quot;: {
&quot;type&quot;: &quot;text&quot;,
&quot;fields&quot;: {
&quot;keyword&quot;: {
&quot;type&quot;: &quot;keyword&quot;,
&quot;ignore_above&quot;: 256
}
}
},
&quot;color&quot;: {
&quot;type&quot;: &quot;text&quot;,
&quot;fields&quot;: {
&quot;keyword&quot;: {
&quot;type&quot;: &quot;keyword&quot;,
&quot;ignore_above&quot;: 256
}
}
},
&quot;price&quot;: {
&quot;type&quot;: &quot;long&quot;
},
&quot;sold_date&quot;: {
&quot;type&quot;: &quot;date&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2) åŸºç¡€èšåˆå®ä¾‹</p><p>a. ç»Ÿè®¡å“ªç§é¢œè‰²çš„ç”µè§†é”€é‡æœ€é«˜</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;max_sales_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†ç»„åä¼šè®¡ç®—å‡ºæ¯ç»„æ•°æ®ä¸ªæ•°(doc_count), é»˜è®¤æŒ‰ç…§doc_counté™åºæ˜¾ç¤º.</p><p>b. ç»Ÿè®¡æ¯ç§é¢œè‰²ç”µè§†çš„å¹³å‡ä»·æ ¼</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
},
&quot;aggs&quot;: {
&quot;avg_price&quot;: {
&quot;avg&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c. ç»Ÿè®¡æ¯ç§é¢œè‰²ç”µè§†çš„å¹³å‡ä»·æ ¼, ä»¥åŠç»Ÿè®¡æ¯ç§é¢œè‰²ä¸‹æ¯ä¸ªå“ç‰Œçš„å¹³å‡ä»·æ ¼.</p><p>è¿™é‡Œå°±æ¶‰åŠåˆ°åµŒå¥—åˆ†ç»„äº†, ä¹Ÿå«åšå¤šå±‚ä¸‹é’»åˆ†æ.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
},
&quot;aggs&quot;: {
&quot;color_avg_price&quot;: {
&quot;avg&quot;: {
&quot;field&quot;: &quot;price&quot;
}
},
&quot;group_by_brand&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;brand.keyword&quot;
},
&quot;aggs&quot;: {
&quot;brand_avg_price&quot;: {
&quot;avg&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d. ç»Ÿè®¡æ¯ç§é¢œè‰²ç”µè§†æœºçš„æœ€å¤§æœ€å°ä»·æ ¼</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
},
&quot;aggs&quot;: {
&quot;max_price&quot;: {
&quot;max&quot;: {
&quot;field&quot;: &quot;price&quot;
}
},
&quot;min_price&quot;: {
&quot;min&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>e. ç»Ÿè®¡æ¯ç§é¢œè‰²ç”µè§†æœºçš„æ€»é”€å”®é¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
},
&quot;aggs&quot;: {
&quot;sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(2) é«˜çº§èšåˆå®ä¾‹</p><p>a. æŒ‰ä»·æ ¼åŒºé—´ç»Ÿè®¡ç”µè§†é”€é‡å’Œé”€å”®é¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_price_range&quot;: {
&quot;histogram&quot;: {
&quot;field&quot;: &quot;price&quot;,
&quot;interval&quot;: 2000
},
&quot;aggs&quot;: {
&quot;sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b. ç»Ÿè®¡ 2016-01-01 ~ 2017-12-31 èŒƒå›´å†…æ¯ä¸ªæœˆçš„ç”µè§†æœºé”€é‡.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_sold_date&quot;: {
&quot;date_histogram&quot;: {
&quot;field&quot;: &quot;sold_date&quot;,
&quot;interval&quot;: &quot;month&quot;,
&quot;format&quot;: &quot;yyyy-MM-dd&quot;,
&quot;min_doc_count&quot;: 0,
&quot;extended_bounds&quot;: {
&quot;min&quot;: &quot;2016-01-01&quot;,
&quot;max&quot;: &quot;2017-12-31&quot;
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>c. ç»Ÿè®¡ 2016-01-01 ~ 2017-12-31 èŒƒå›´å†…æ¯ä¸ªå­£åº¦çš„é”€å”®é¢ä»¥åŠè¯¥å­£åº¦ä¸‹æ¯ä¸ªå“ç‰Œçš„é”€å”®é¢</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_sold_date&quot;: {
&quot;date_histogram&quot;: {
&quot;field&quot;: &quot;sold_date&quot;,
&quot;interval&quot;: &quot;quarter&quot;,
&quot;format&quot;: &quot;yyyy-MM-dd&quot;,
&quot;min_doc_count&quot;: 0,
&quot;extended_bounds&quot;: {
&quot;min&quot;: &quot;2016-01-01&quot;,
&quot;max&quot;: &quot;2017-12-31&quot;
}
},
&quot;aggs&quot;: {
&quot;sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
},
&quot;group_by_brand&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;brand.keyword&quot;
},
&quot;aggs&quot;: {
&quot;brand_sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>d. ç»Ÿè®¡æ¯ç§é¢œè‰²ç”µè§†çš„é”€å”®é¢, æŒ‰ç…§é”€å”®é¢å‡åºæ’åº</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;,
&quot;order&quot;: {
&quot;sum_price&quot;: &quot;asc&quot;
}
},
&quot;aggs&quot;: {
&quot;sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>e. ç»Ÿè®¡æ¯ç§é¢œè‰²ä¸‹çš„æ¯ä¸ªå“ç‰Œç”µè§†æœºçš„æ€»é”€å”®é¢, å¹¶æŒ‰è¿™ä¸ªé”€å”®é¢å‡åºæ’åº.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
},
&quot;aggs&quot;: {
&quot;group_by_brand&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;brand.keyword&quot;,
&quot;order&quot;: {
&quot;color_brand_sum_price&quot;: &quot;asc&quot;
}
},
&quot;aggs&quot;: {
&quot;color_brand_sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>f. ç»Ÿè®¡æ¯ä¸ªæœˆçš„ç”µè§†é”€é‡, å¹¶æŒ‰å“ç‰Œå»é‡.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_sold_date&quot;: {
&quot;date_histogram&quot;: {
&quot;field&quot;: &quot;sold_date&quot;,
&quot;interval&quot;: &quot;month&quot;,
&quot;format&quot;: &quot;yyyy-MM-dd&quot;
},
&quot;aggs&quot;: {
&quot;distinct_brand&quot;: {
&quot;cardinality&quot;: {
&quot;field&quot;: &quot;brand.keyword&quot;,
&quot;precision_threshold&quot;: 100
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cardinality å»é‡é‡‡ç”¨çš„æ˜¯è¿‘ä¼¼ä¼°è®¡çš„ç®—æ³•, é”™è¯¯ç‡åœ¨5%å·¦å³, å…¶ä¸­precision_thresholdæŒ‡å®šçš„å€¼ä¸º100%å‡†ç¡®å»é‡çš„æ•°é‡, å€¼è®¾ç½®çš„è¶Šå¤§, å†…å­˜å¼€é”€ä¹Ÿå°±è¶Šå¤§.</p><p>g. ç»Ÿè®¡50%, 90% å’Œ 99%çš„ç”µè§†çš„æœ€å¤§ä»·æ ¼(ä¸€èˆ¬ç”¨äºç»Ÿè®¡apiè¯·æ±‚çš„æœ€é•¿å»¶è¿Ÿæ—¶é—´)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;price_percentiles&quot;: {
&quot;percentiles&quot;: {
&quot;field&quot;: &quot;price&quot;,
&quot;percents&quot;: [
50,
90,
99
]
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>h. ç»Ÿè®¡æ¯ä¸ªå“ç‰Œçš„ç”µè§†æœºçš„ä»·æ ¼, åœ¨1000ä»¥å†…, 2000ä»¥å†…, 3000ä»¥å†…, 4000ä»¥å†…çš„æ‰€å æ¯”ä¾‹.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;aggs&quot;: {
&quot;group_by_brand&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;brand.keyword&quot;
},
&quot;aggs&quot;: {
&quot;price_percentile_ranks&quot;: {
&quot;percentile_ranks&quot;: {
&quot;field&quot;: &quot;price&quot;,
&quot;values&quot;: [
1000,
2000,
3000,
4000
]
}
}
}
}
}
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) æœç´¢+èšåˆ</p><p>a. ç»Ÿè®¡æŒ‡å®šå“ç‰Œä¸‹(å°ç±³)æ¯ä¸ªé¢œè‰²çš„é”€é‡</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;query&quot;: {
&quot;term&quot;: {
&quot;brand.keyword&quot;: {
&quot;value&quot;: &quot;å°ç±³&quot;
}
}
},
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
}
}
}
}
æˆ–è€…

GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;term&quot;: {
&quot;brand.keyword&quot;: &quot;å°ç±³&quot;
}
}
}
},
&quot;aggs&quot;: {
&quot;group_by_color&quot;: {
&quot;terms&quot;: {
&quot;field&quot;: &quot;color.keyword&quot;
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶å®å¯¹äºèšåˆæ¥è¯´, å› ä¸ºä¸éœ€è¦æœç´¢ç»“æœ, å¯ä»¥ç›´æ¥ç”¨filter, æ•ˆç‡æ›´é«˜.</p><p>b. ç»Ÿè®¡å•ä¸ªå“ç‰Œ(é•¿è™¹)ä¸æ‰€æœ‰å“ç‰Œé”€å”®é¢å¯¹æ¯”</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;query&quot;: {
&quot;constant_score&quot;: {
&quot;filter&quot;: {
&quot;term&quot;: {
&quot;brand.keyword&quot;: &quot;é•¿è™¹&quot;
}
}
}
},
&quot;aggs&quot;: {
&quot;single_brand_sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
},
&quot;all_brand&quot;: {
&quot;global&quot;: {},
&quot;aggs&quot;: {
&quot;all_brand_sum_price&quot;: {
&quot;sum&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>global è¡¨ç¤ºå°†æ‰€æœ‰æ•°æ®çº³å…¥èšåˆçš„scopeï¼Œå¿½è§†å‰é¢çš„queryè¿‡æ»¤.</p><p>c. ç»Ÿè®¡æŒ‡å®šå“ç‰Œ(é•¿è™¹)æœ€è¿‘ä¸€ä¸ªæœˆå’Œæœ€è¿‘åŠå¹´çš„å¹³å‡ä»·æ ¼</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>GET /televisions/sales/_search
{
&quot;size&quot;: 0,
&quot;query&quot;: {
&quot;term&quot;: {
&quot;brand.keyword&quot;: {
&quot;value&quot;: &quot;é•¿è™¹&quot;
}
}
},
&quot;aggs&quot;: {
&quot;recent_one_month&quot;: {
&quot;filter&quot;: {
&quot;range&quot;: {
&quot;sold_date&quot;: {
&quot;gte&quot;: &quot;now-1M&quot;
}
}
},
&quot;aggs&quot;: {
&quot;recent_one_month_avg_price&quot;: {
&quot;avg&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
},
&quot;recent_six_month&quot;: {
&quot;filter&quot;: {
&quot;range&quot;: {
&quot;sold_date&quot;: {
&quot;gte&quot;: &quot;now-6M&quot;
}
}
},
&quot;aggs&quot;: {
&quot;recent_six_month_avg_price&quot;: {
&quot;avg&quot;: {
&quot;field&quot;: &quot;price&quot;
}
}
}
}
}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/easywhx/learning/edit/main/note/elasticsearch/esçš„åŸºæœ¬ä½¿ç”¨.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: wanhx@xports.cn">wanhx</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/note/elasticsearch/es%E5%92%8Ckibana%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html" class="nav-link prev" aria-label="eså’Œkibanaå®‰è£…é…ç½®"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->eså’Œkibanaå®‰è£…é…ç½®</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.4d667c68.js" defer></script>
  </body>
</html>
